[ ] NAME:Implement Comprehensive Budgeting Feature DESCRIPTION:Implement a complete budgeting system with monthly planning, budget vs actual comparison, and copy functionality for GeekBudgetBE
-[ ] NAME:Implement Budget Items API Service DESCRIPTION:Replace the stubbed BudgetItemsAPIService implementation with actual CRUD operations using the existing database storage interface. Implement GetBudgetItems, CreateBudgetItem, GetBudgetItem, UpdateBudgetItem, and DeleteBudgetItem methods with proper user authentication and error handling.
--[ ] NAME:Create API service scaffold DESCRIPTION:Create pkg/server/api/api_budget_items.go with type BudgetItemsAPIServiceImpl { logger *slog.Logger; db database.Storage } and constructor NewBudgetItemsAPIService(logger *slog.Logger, db database.Storage) goserver.BudgetItemsAPIServicer. Ensure file compiles.
--[ ] NAME:Implement CreateBudgetItem handler DESCRIPTION:In pkg/server/api/api_budget_items.go implement CreateBudgetItem(ctx context.Context, body goserver.BudgetItemNoId): extract userID from ctx (common.UserIDKey), call s.db.CreateBudgetItem(userID, &body), return goserver.Response(200, created). Add error logging on failure.
--[ ] NAME:Implement GetBudgetItems and GetBudgetItem DESCRIPTION:In pkg/server/api/api_budget_items.go implement GetBudgetItems(ctx) -> s.db.GetBudgetItems(userID); GetBudgetItem(ctx, id) -> s.db.GetBudgetItem(userID, id). Return goserver.Response(200, ...), log errors.
--[ ] NAME:Implement UpdateBudgetItem and DeleteBudgetItem with logging DESCRIPTION:In pkg/server/api/api_budget_items.go implement UpdateBudgetItem(ctx, id, body) -> s.db.UpdateBudgetItem; DeleteBudgetItem(ctx, id) -> s.db.DeleteBudgetItem. Ensure consistent slog error logging.
-[ ] NAME:Add Budget Items API Service to Server DESCRIPTION:Register the BudgetItemsAPIService implementation in the server configuration (pkg/server/server.go) so the API endpoints become functional.
--[ ] NAME:Register BudgetItems service in server DESCRIPTION:Edit pkg/server/server.go createControllers(): add BudgetItemsAPIService: api.NewBudgetItemsAPIService(logger, db). Ensure goserver.NewRouter wires controllers.
--[ ] NAME:Start server and smoke test endpoints DESCRIPTION:Run make run (or go run cmd/main.go server). Using a token, curl GET /v1/budgetItems -> expect 200 (possibly empty array).
--[ ] NAME:Lint new code DESCRIPTION:Run make lint and fix any issues in pkg/server/api/api_budget_items.go or server wiring.
-[ ] NAME:Enhance Budget Storage Interface DESCRIPTION:Add specialized database methods for budget management: GetBudgetItemsByMonth, GetBudgetItemsByUserAndMonth, CopyBudgetToMonth. These will support monthly budget operations and budget copying functionality.
--[ ] NAME:Add monthly helper methods to Storage interface DESCRIPTION:In pkg/database/storage.go add signatures: GetBudgetItemsByMonth(userID string, monthStart time.Time) ([]goserver.BudgetItem, error); CopyBudgetToMonth(userID string, fromMonthStart, toMonthStart time.Time) (int, error).
--[ ] NAME:Implement GetBudgetItemsByMonth DESCRIPTION:In pkg/database/storage.go (storage) implement GetBudgetItemsByMonth: SELECT BudgetItem WHERE user_id=? AND date>=monthStart AND date<monthStart.AddDate(0,1,0); map to goserver.BudgetItem.
--[ ] NAME:Implement CopyBudgetToMonth (transaction) DESCRIPTION:In pkg/database/storage.go implement CopyBudgetToMonth: fetch from-month items, create new items with Date set to toMonthStart (first day), new IDs; wrap in transaction; return count.
--[ ] NAME:Update mocks for new methods DESCRIPTION:Edit pkg/database/mocks/mock_storage.go to add methods GetBudgetItemsByMonth and CopyBudgetToMonth with gomock stubs.
-[ ] NAME:Create Budget Service Layer DESCRIPTION:Create a dedicated budget service layer (pkg/server/budget/) that encapsulates budget business logic: monthly budget validation, expense account filtering, budget copying, and comparison calculations. This will be used by both API and web handlers.
--[ ] NAME:Create budget service package and constructor DESCRIPTION:Create pkg/server/budget/service.go with type Service{logger *slog.Logger; db database.Storage} and NewService(...). Ensure package compiles.
--[ ] NAME:Implement ValidateFutureMonth DESCRIPTION:In pkg/server/budget/service.go implement ValidateFutureMonth(monthStart time.Time) error: compute first day of next month; require monthStart >= that date; else return error.
--[ ] NAME:Implement ListMonthlyBudget DESCRIPTION:In pkg/server/budget/service.go implement ListMonthlyBudget(ctx, userID string, monthStart time.Time) ([]goserver.BudgetItem, error) -> delegate to db.GetBudgetItemsByMonth.
--[ ] NAME:Implement SaveMonthlyBudget DESCRIPTION:In pkg/server/budget/service.go implement SaveMonthlyBudget(ctx, userID string, monthStart time.Time, entries []goserver.BudgetItemNoId) error: ValidateFutureMonth; fetch accounts and filter expense only; delete existing month items then create entries via db.CreateBudgetItem.
-[ ] NAME:Create Budget Planning Web Handler DESCRIPTION:Create budgetPlanningHandler in pkg/server/webapp/ that displays a form for creating/editing monthly budgets. Include month selection, account filtering (expense accounts only), and budget amount input fields. Follow existing handler patterns for authentication and template rendering.
--[ ] NAME:Create planning handler scaffold DESCRIPTION:Create pkg/server/webapp/budget_planning_handler.go with func (r *WebAppRouter) budgetPlanningHandler(w http.ResponseWriter, req *http.Request): loadTemplates, ValidateUserID, data := utils.CreateTemplateData(req, "budget_planning").
--[ ] NAME:Implement GET: month parse, accounts, existing budget DESCRIPTION:In budget_planning_handler.go GET branch: parse month (default next month 1st), r.db.GetAccounts(userID), filter expense accounts, call budget.Service.ListMonthlyBudget, put in data map.
--[ ] NAME:Implement POST: save monthly budget DESCRIPTION:In budget_planning_handler.go POST branch: parse month and amounts per account; build []goserver.BudgetItemNoId with Date=monthStart; call service.SaveMonthlyBudget; redirect back with success or error.
--[ ] NAME:Add error handling and CurrentPage DESCRIPTION:In budget_planning_handler.go: on errors log r.logger.Error and set data["Error"]; ensure data["CurrentPage"]="budget_planning".
-[ ] NAME:Create Budget Planning Template DESCRIPTION:Create webapp/templates/budget_planning.tpl with a form interface for monthly budget creation/editing. Include month/year picker, expense account selection, amount input fields, and copy-from-previous-month functionality. Use Bootstrap 5 styling consistent with existing templates.
--[ ] NAME:Create budget_planning.tpl skeleton DESCRIPTION:Add webapp/templates/budget_planning.tpl with header/footer, page title, and placeholders for controls and table.
--[ ] NAME:Add month navigation controls DESCRIPTION:In budget_planning.tpl add left/right buttons using addQueryParam on current URL with key "month" (timestamp of month start), display selected month label.
--[ ] NAME:Render accounts table with inputs DESCRIPTION:In budget_planning.tpl render expense accounts in a table with amount inputs, prefilled from .BudgetItems (map by AccountId).
--[ ] NAME:Add POST form for saving DESCRIPTION:In budget_planning.tpl add <form method="POST"> with hidden month field and inputs per account; show .Error alert on errors and success banner on redirect param.
-[ ] NAME:Add Budget Planning Routes DESCRIPTION:Add budget planning routes to webapp router: GET /web/budget/plan for displaying the planning interface, POST /web/budget/plan for saving budget data, and POST /web/budget/copy for copying previous month's budget.
--[ ] NAME:Add GET /web/budget/plan route DESCRIPTION:Edit pkg/server/webapp/webapp.go Routes(): add "BudgetPlanGET": GET "/web/budget/plan" -> r.budgetPlanningHandler.
--[ ] NAME:Add POST /web/budget/plan route DESCRIPTION:Edit pkg/server/webapp/webapp.go Routes(): add "BudgetPlanPOST": POST "/web/budget/plan" -> r.budgetPlanningHandler.
--[ ] NAME:Smoke test planning routes DESCRIPTION:Start server and open /web/budget/plan (GET) and submit form (POST); expect 200 and redirect. Fix any template function usage issues.
-[ ] NAME:Add Future Date Validation DESCRIPTION:Implement validation in both API and web handlers to ensure budget dates are in the future (not past months). Add appropriate error messages and user feedback for invalid date selections.
--[ ] NAME:Enforce future month in service save DESCRIPTION:Ensure SaveMonthlyBudget uses ValidateFutureMonth and returns error with clear message for invalid months.
--[ ] NAME:Add API level validation for BudgetItems DESCRIPTION:In pkg/server/api/api_budget_items.go Create/Update handlers: reject body.Date that belongs to past/current month; log error and return 500/400 per project convention.
--[ ] NAME:Show validation errors in template DESCRIPTION:In webapp/templates/budget_planning.tpl render .Error in Bootstrap alert like accounts_edit.tpl when SaveMonthlyBudget returns error.
-[ ] NAME:Implement Budget vs Actual Comparison Logic DESCRIPTION:Create budget comparison service that aggregates actual expenses by month and account, then compares against budget items. Include over/under budget calculations and percentage differences. Build on existing aggregation patterns from api_aggregations.go.
--[ ] NAME:Define Comparison struct and stub CompareMonthly DESCRIPTION:In pkg/server/budget/service.go define type Comparison{ Rows []Row; TotalPlanned, TotalActual, TotalDelta float64 } and Row{ AccountId, AccountName string; Planned, Actual, Delta float64 }. Add stub func CompareMonthly(...).
--[ ] NAME:Build planned map from budget items DESCRIPTION:In CompareMonthly: call db.GetBudgetItemsByMonth, build map[accountId]planned.
--[ ] NAME:Compute actual expenses per account DESCRIPTION:Fetch accounts and transactions for [monthStart, monthStart+1m); filter expense movements and sum by account; optionally convert using common.NewCurrenciesRatesFetcher and currency map.
--[ ] NAME:Assemble DTO with totals DESCRIPTION:In CompareMonthly: merge account list into []Row with AccountName, Planned, Actual, Delta=Actual-Planned; compute totals.
-[ ] NAME:Create Budget Comparison Web Handler DESCRIPTION:Create budgetComparisonHandler that displays side-by-side budget vs actual expense comparison. Include month navigation (forward/backward), account filtering, and summary statistics. Follow existing patterns from home_handler.go and transactions_handler.go.
--[ ] NAME:Create comparison handler scaffold DESCRIPTION:Create pkg/server/webapp/budget_comparison_handler.go with func (r *WebAppRouter) budgetComparisonHandler(w, req) to loadTemplates, ValidateUserID, and data := utils.CreateTemplateData(req, "budget_comparison").
--[ ] NAME:Parse month and call CompareMonthly DESCRIPTION:In budget_comparison_handler.go: parse month param (default current month), call budget.Service.CompareMonthly(userID, monthStart, optional currency), put result in data.
--[ ] NAME:Add navigation and CurrentPage DESCRIPTION:In budget_comparison_handler.go: add prev/next month URLs with addQueryParam and timestamp; set data["CurrentPage"]="budget_comparison".
-[ ] NAME:Create Budget Comparison Template DESCRIPTION:Create webapp/templates/budget_comparison.tpl with a table showing planned vs actual expenses by account for selected month. Include navigation controls, over/under budget indicators, and summary totals. Use consistent styling with existing templates.
--[ ] NAME:Create budget_comparison.tpl skeleton DESCRIPTION:Add webapp/templates/budget_comparison.tpl with header/footer and title.
--[ ] NAME:Render comparison table DESCRIPTION:In budget_comparison.tpl render table: Account | Planned | Actual | Delta; totals row; use money helper; color delta cell (red negative, green positive).
--[ ] NAME:Add summary header DESCRIPTION:In budget_comparison.tpl show summary badges for total planned, actual, delta.
-[ ] NAME:Add Budget Comparison Routes DESCRIPTION:Add budget comparison routes to webapp router: GET /web/budget/compare for displaying the comparison interface with month navigation support.
--[ ] NAME:Add GET /web/budget/compare route DESCRIPTION:Edit pkg/server/webapp/webapp.go Routes(): add "BudgetCompareGET": GET "/web/budget/compare" -> r.budgetComparisonHandler.
--[ ] NAME:Smoke test compare route DESCRIPTION:Start server, open /web/budget/compare; expect 200 and table renders (even if empty).
-[ ] NAME:Add Budget Copy Functionality DESCRIPTION:Implement the ability to copy budget items from a previous month to a new month. Include validation to prevent overwriting existing budgets and provide user confirmation. Add this as both API endpoint and web interface feature.
--[ ] NAME:Add copy action to planning handler DESCRIPTION:In budget_planning_handler.go handle POST with action=copy: determine fromMonthStart (default previous month) and toMonthStart (selected); call service.CopyFromPreviousMonth; redirect with success banner.
--[ ] NAME:Add copy UI in template DESCRIPTION:In webapp/templates/budget_planning.tpl add "Copy previous month" button as POST form with hidden action=copy and month fields.
--[ ] NAME:Show copy success/error messages DESCRIPTION:In budget_planning_handler.go and template, show Bootstrap alert for copy result (e.g., "Copied N items").
-[ ] NAME:Add Budget Navigation to Header DESCRIPTION:Update webapp/templates/header.tpl to include budget-related navigation links: 'Budget Planning' and 'Budget vs Actual' menu items. Follow existing navigation patterns and ensure proper active state highlighting.
--[ ] NAME:Add Budget menu items DESCRIPTION:Edit webapp/templates/header.tpl: add nav items for Budget Plan (/web/budget/plan) and Budget vs Actual (/web/budget/compare) with active class when CurrentPage matches.
--[ ] NAME:Verify header styling/active state DESCRIPTION:Open both pages and verify correct active link highlighting and Bootstrap classes consistent with existing nav.
-[ ] NAME:Add Budget Tests DESCRIPTION:Create comprehensive tests for budget functionality: unit tests for budget service layer, integration tests for API endpoints, and web handler tests. Follow existing test patterns in test/ directory and pkg/server/api/ test files.
--[ ] NAME:Test: storage monthly query DESCRIPTION:Create test/budget_storage_test.go: seed items across months; assert GetBudgetItemsByMonth returns only target month; run go test ./...
--[ ] NAME:Test: service validation & save DESCRIPTION:Create pkg/server/budget/service_test.go: test ValidateFutureMonth rejects past/current; test SaveMonthlyBudget rejects past/current and non-expense accounts; run go test ./...
--[ ] NAME:Test: comparison logic DESCRIPTION:Create pkg/server/budget/service_compare_test.go: provide planned and transactions, assert planned/actual/delta totals; run go test ./...
--[ ] NAME:Test: web smoke for planning/compare DESCRIPTION:Create test/web_budget_integration_test.go: start server, login test/test, GET /web/budget/plan and /web/budget/compare -> 200; run go test ./test -run Budget