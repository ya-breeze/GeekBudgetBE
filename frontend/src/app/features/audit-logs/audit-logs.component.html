<div class="container">
    <div class="header">
        <h1>Audit Logs</h1>
        <button mat-icon-button (click)="loadData()" [disabled]="loading()">
            <mat-icon>refresh</mat-icon>
        </button>
    </div>

    <div class="filters">
        <mat-form-field appearance="outline">
            <mat-label>Entity Type</mat-label>
            <input
                matInput
                [ngModel]="entityType()"
                (ngModelChange)="entityType.set($event)"
                (keyup.enter)="loadData()"
            />
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Entity ID</mat-label>
            <input
                matInput
                [ngModel]="entityId()"
                (ngModelChange)="entityId.set($event)"
                (keyup.enter)="loadData()"
            />
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Date From</mat-label>
            <input
                matInput
                [matDatepicker]="pickerFrom"
                [ngModel]="dateFrom()"
                (ngModelChange)="dateFrom.set($event)"
            />
            <mat-datepicker-toggle matSuffix [for]="pickerFrom"></mat-datepicker-toggle>
            <mat-datepicker #pickerFrom></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Date To</mat-label>
            <input
                matInput
                [matDatepicker]="pickerTo"
                [ngModel]="dateTo()"
                (ngModelChange)="dateTo.set($event)"
            />
            <mat-datepicker-toggle matSuffix [for]="pickerTo"></mat-datepicker-toggle>
            <mat-datepicker #pickerTo></mat-datepicker>
        </mat-form-field>

        <button mat-stroked-button (click)="loadData()" [disabled]="loading()">Filter</button>
        <button mat-icon-button (click)="clearFilters()" matTooltip="Clear filters">
            <mat-icon>clear</mat-icon>
        </button>
    </div>

    <div class="loading-shade" *ngIf="loading()">
        <mat-spinner></mat-spinner>
    </div>

    <div class="table-container mat-elevation-z8">
        <table mat-table [dataSource]="dataSource" matSort>
            <ng-container matColumnDef="createdAt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
                <td mat-cell *matCellDef="let log">{{ log.createdAt | appDate: 'medium' }}</td>
            </ng-container>

            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Action</th>
                <td mat-cell *matCellDef="let log">{{ log.action }}</td>
            </ng-container>

            <ng-container matColumnDef="entityType">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Entity Type</th>
                <td mat-cell *matCellDef="let log">{{ log.entityType }}</td>
            </ng-container>

            <ng-container matColumnDef="entityId">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Entity ID</th>
                <td mat-cell *matCellDef="let log" [matTooltip]="log.entityId">
                    {{ log.entityId | slice: 0 : 8 }}...
                </td>
            </ng-container>

            <ng-container matColumnDef="changeSource">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Source</th>
                <td mat-cell *matCellDef="let log">{{ log.changeSource }}</td>
            </ng-container>

            <ng-container matColumnDef="snapshot">
                <th mat-header-cell *matHeaderCellDef>Snapshot</th>
                <td mat-cell *matCellDef="let log">
                    <div class="snapshot-cell" [matTooltip]="log.snapshot">
                        {{ log.snapshot | slice: 0 : 50 }}...
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns"
                (click)="openDetailDialog(row)"
                class="clickable-row"
            ></tr>

            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="6">No data matching the filter</td>
            </tr>
        </table>

        <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
    </div>
</div>
