<div class="accounts-container">
    @if (!sidenavOpened()) {
        <h1 class="page-title">Accounts</h1>
    }

    <div class="header">
        <button mat-raised-button color="primary" (click)="openCreateDialog()">
            <mat-icon>add</mat-icon>
            Add Account
        </button>
    </div>

    @if (loading()) {
        <div class="loading-container">
            <mat-spinner></mat-spinner>
        </div>
    } @else {
        <div class="table-container">
            <table
                mat-table
                [dataSource]="sortedAccounts()"
                matSort
                (matSortChange)="onSortChange($event)"
                [matSortActive]="sortActive() ?? displayedColumns()[0]"
                [matSortDirection]="sortDirection()"
                class="accounts-table"
            >
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
                    <td mat-cell *matCellDef="let account">
                        <div class="account-name-container">
                            @if (account.image) {
                                <img
                                    [src]="account.image | imageUrl"
                                    alt=""
                                    class="account-icon-small"
                                />
                            }
                            <span>{{ account.name }}</span>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                    <td mat-cell *matCellDef="let account">
                        <mat-chip [ngClass]="['account-type-chip', account.type]">
                            {{ account.type }}
                        </mat-chip>
                    </td>
                </ng-container>

                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Description</th>
                    <td mat-cell *matCellDef="let account">{{ account.description || '-' }}</td>
                </ng-container>

                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>Actions</th>
                    <td mat-cell *matCellDef="let account">
                        <button mat-icon-button (click)="openEditDialog(account)" aria-label="Edit">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button
                            mat-icon-button
                            color="warn"
                            (click)="deleteAccount(account)"
                            aria-label="Delete"
                        >
                            <mat-icon>delete</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns()"></tr>

                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" [attr.colspan]="displayedColumns().length">
                        No accounts found. Click "Add Account" to create one.
                    </td>
                </tr>
            </table>
        </div>
    }
</div>
