<h2 mat-dialog-title>Process Transaction</h2>
<mat-dialog-content>
  <div class="section-container transaction-details">
    <h3 class="section-title">Transaction Details</h3>
    <div class="details-grid">
      <div class="detail-item">
        <span class="label">Date:</span>
        <span class="value">{{ data.transaction.date | date:'medium' }}</span>
      </div>
      <div class="detail-item">
        <span class="label">Description:</span>
        <span class="value">{{ data.transaction.description }}</span>
      </div>
      <div class="detail-item">
        <span class="label">Tags:</span>
        <span class="value">{{ data.transaction.tags?.join(', ') || '-' }}</span>
      </div>

      @if (shouldShowEffectiveAmount) {
      <div class="detail-item highlight">
        <span class="label">Amount:</span>
        <span class="value amount">{{ effectiveAmount?.amount }} {{ effectiveAmount?.currencyName }}</span>
      </div>
      }
    </div>

    @if (!shouldShowEffectiveAmount) {
    <div class="sub-section">
      <h4>Movements</h4>
      <mat-list>
        @for (movement of data.transaction.movements; track $index) {
        <mat-list-item>
          <span matListItemTitle>{{ movement.amount }} {{ getCurrencyName(movement.currencyId) }}</span>
          <span matListItemLine>{{ getAccountName(movement.accountId) }}</span>
          <span matListItemLine>{{ movement.description || 'No description' }}</span>
        </mat-list-item>
        }
      </mat-list>
    </div>
    }
  </div>

  <div class="section-separator"></div>

  <div class="section-container matches-section" [class.has-content]="data.matched.length > 0">
    <h3 class="section-title">Matches <span class="badge">{{ data.matched.length }}</span></h3>
    @if (data.matched.length > 0) {
    <div class="custom-list">
      @for (match of data.matched; track match.matcherId) {
      <div class="custom-list-item">
        <div class="item-content">
          <div class="item-title">{{ match.transaction.description }}</div>
          <div class="item-subtitle">{{ match.transaction.date | date:'shortDate' }}</div>
        </div>
        <button mat-icon-button (click)="applyMatch(match)" color="primary" aria-label="Apply Match"
          matTooltip="Apply Match">
          <mat-icon>check_circle</mat-icon>
        </button>
      </div>
      }
    </div>
    } @else {
    <p class="empty-state">No matches found.</p>
    }
  </div>

  <div class="section-separator"></div>

  <div class="section-container duplicates-section" [class.has-content]="data.duplicates.length > 0">
    <h3 class="section-title">Potential Duplicates <span class="badge warn">{{ data.duplicates.length }}</span></h3>
    @if (data.duplicates.length > 0) {
    <div class="custom-list">
      @for (duplicate of data.duplicates; track duplicate.id) {
      <div class="custom-list-item">
        <div class="item-content">
          <div class="item-title">{{ duplicate.description }}</div>
          <div class="item-subtitle">{{ duplicate.date | date:'medium' }}</div>
        </div>
        <button mat-icon-button (click)="applyDuplicate(duplicate)" color="warn" aria-label="Confirm Duplicate"
          matTooltip="Merge/Delete Duplicate">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      }
    </div>
    } @else {
    <p class="empty-state">No duplicates found.</p>
    }
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Close</button>
</mat-dialog-actions>