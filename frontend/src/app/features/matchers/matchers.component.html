<div class="matchers-container">
  @if (!sidenavOpened()) {
  <div class="header-actions">
    <h1 class="page-title">Matchers</h1>
    <button mat-raised-button color="primary" (click)="openMatcherDialog()">
      <mat-icon>add</mat-icon> Add Matcher
    </button>
  </div>
  } @else {
  <!-- Even if sidenav open, we might want the button, but based on existing code it hides title. 
           Let's assume we want the button accessible. 
           But following existing pattern for title. 
           Let's put the button in a toolbar or just above table if sidenav is closed?
           Actually, the previous code only acted on !sidenavOpened() for title.
           I'll verify if there's a place for it. 
           Let's add a toolbar-like container. -->
  @if (sidenavOpened()) {
  <div class="actions-bar">
    <button mat-raised-button color="primary" (click)="openMatcherDialog()">
      <mat-icon>add</mat-icon> Add Matcher
    </button>
  </div>
  }
  }

  @if (loading()) {
  <div class="loading-container">
    <mat-spinner></mat-spinner>
  </div>
  } @else {
  <div class="table-container">
    <table mat-table [dataSource]="matchers()" matSort (matSortChange)="onSortChange($event)"
      [matSortActive]="sortActive() ?? displayedColumns()[0]" [matSortDirection]="sortDirection()"
      class="matchers-table">


      <ng-container matColumnDef="outputAccount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Output Account</th>
        <td mat-cell *matCellDef="let matcher">
          {{ matcher.outputAccountName || matcher.outputAccountId }}
        </td>
      </ng-container>

      <ng-container matColumnDef="outputDescription">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Output Description</th>
        <td mat-cell *matCellDef="let matcher">{{ matcher.outputDescription }}</td>
      </ng-container>

      <ng-container matColumnDef="confidence">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Confidence</th>
        <td mat-cell *matCellDef="let matcher">
          <span [class]="'confidence-badge ' + getConfidenceBadge(matcher).class"
            [matTooltip]="getConfidenceBadge(matcher).tooltip">
            {{ getConfidenceBadge(matcher).text }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let matcher">
          <button mat-icon-button color="warn" (click)="$event.stopPropagation(); deleteMatcher(matcher)"
            matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns()" (click)="openMatcherDialog(row)"
        class="clickable-row"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns().length">No matchers found.</td>
      </tr>
    </table>
  </div>
  }
</div>