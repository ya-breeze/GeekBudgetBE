
> geek-budget-fe@0.0.0 lint
> ng lint --format json


Linting "geek-budget-fe"...
[{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/app.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/app.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/app.routes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/app.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/app.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/guards/auth.guard.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/guards/auth.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/guards/no-auth.guard.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/guards/no-auth.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/interceptors/auth.interceptor.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/interceptors/auth.interceptor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/interceptors/error.interceptor.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":9,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { HttpInterceptorFn, HttpErrorResponse } from '@angular/common/http';\nimport { inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { catchError, throwError } from 'rxjs';\nimport { AuthService } from '../services/auth.service';\n\nexport const errorInterceptor: HttpInterceptorFn = (req, next) => {\n    const authService = inject(AuthService);\n    const router = inject(Router);\n\n    return next(req).pipe(\n        catchError((error: HttpErrorResponse) => {\n            let errorMessage = 'An error occurred';\n\n            if (error.error instanceof ErrorEvent) {\n                // Client-side error\n                errorMessage = error.error.message;\n            } else {\n                // Server-side error\n                switch (error.status) {\n                    case 401:\n                        authService.logout();\n                        errorMessage = 'Session expired. Please login again.';\n                        break;\n                    case 403:\n                        errorMessage = 'Access denied';\n                        break;\n                    case 404:\n                        errorMessage = 'Resource not found';\n                        break;\n                    case 429:\n                        errorMessage = 'Too many requests. Please try again later.';\n                        break;\n                    case 500:\n                        errorMessage = 'Server error. Please try again later.';\n                        break;\n                    default:\n                        errorMessage = error.error?.message || error.message;\n                }\n            }\n\n            console.error('HTTP Error:', errorMessage, error);\n            return throwError(() => new Error(errorMessage));\n        }),\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/services/auth.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/auth/services/auth.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/core/services/user.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/accounts/account-form-dialog/account-form-dialog.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/accounts/account-form-dialog/account-form-dialog.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/accounts/accounts.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/accounts/accounts.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/accounts/services/account.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/accounts/services/account.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/auth/login/login.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/auth/login/login.component.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/auth/login/login.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/bank-importers/bank-importer-form-dialog/bank-importer-form-dialog.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/bank-importers/bank-importer-form-dialog/bank-importer-form-dialog.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/bank-importers/bank-importers.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/bank-importers/bank-importers.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/bank-importers/services/bank-importer.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/bank-importers/services/bank-importer.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/budget-items/budget-items.component.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/budget-items/budget-items.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sort' is defined but never used.","line":3,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DecimalPipe' is defined but never used.","line":8,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Validators' is defined but never used.","line":9,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormsModule' is defined but never used.","line":9,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AccountSelectComponent' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, OnInit, signal, computed, effect } from '@angular/core';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatSortModule, Sort } from '@angular/material/sort';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSnackBar, MatSnackBarModule } from '@angular/material/snack-bar';\nimport { DatePipe, DecimalPipe, CurrencyPipe, CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, FormBuilder, Validators, FormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatNativeDateModule } from '@angular/material/core';\nimport { MatDialog, MatDialogModule } from '@angular/material/dialog';\nimport { BudgetItemService } from './services/budget-item.service';\nimport { AccountService } from '../accounts/services/account.service';\nimport { UserService } from '../../core/services/user.service'; // Added\nimport { CurrencyService } from '../currencies/services/currency.service'; // Added\nimport { BudgetItem } from '../../core/api/models/budget-item';\nimport { BudgetStatus } from '../../core/api/models/budget-status';\nimport { LayoutService } from '../../layout/services/layout.service';\nimport { AccountSelectComponent } from '../../shared/components/account-select/account-select.component';\nimport { BudgetMatrixEditComponent } from './components/budget-matrix-edit/budget-matrix-edit.component';\n\ninterface MatrixCell {\n    month: string; // YYYY-MM-01\n    amount: number; // Planned (Converted)\n    rawAmount: number; // For editing\n    spent: number; // (Converted)\n    budgetItemId?: string; // If exists for editing\n    calculatedAvailable?: number; // For styling\n    isVirtual?: boolean;\n}\n\ninterface MatrixRow {\n    account: { id: string; name: string };\n    cells: MatrixCell[];\n    totalPlanned: number;\n    totalSpent: number;\n    averageSpent: number;\n}\n\n@Component({\n    selector: 'app-budget-items',\n    imports: [\n        MatTableModule,\n        MatSortModule,\n        MatButtonModule,\n        MatIconModule,\n        MatProgressSpinnerModule,\n        MatSnackBarModule,\n        DatePipe,\n        CurrencyPipe,\n        CommonModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatDatepickerModule,\n        MatNativeDateModule,\n        MatDialogModule,\n    ],\n    template: `\n        <div class=\"budget-items-container\">\n            @if (!sidenavOpened()) {\n                <h1 class=\"page-title\">Budget Items</h1>\n            }\n\n            @if (loading()) {\n                <div class=\"loading-container\">\n                    <mat-spinner></mat-spinner>\n                </div>\n            } @else {\n                <div class=\"matrix-container\">\n                    <div\n                        class=\"matrix-header\"\n                        style=\"display: flex; flex-direction: column; gap: 16px; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #eee;\"\n                    >\n                        <div\n                            class=\"title-row\"\n                            style=\"display: flex; align-items: center; gap: 16px;\"\n                        >\n                            <h2>Budget Matrix</h2>\n                            <span\n                                class=\"currency-badge\"\n                                style=\"background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;\"\n                                *ngIf=\"targetCurrencySymbol() as curr\"\n                                >Currency: {{ curr }}</span\n                            >\n                        </div>\n\n                        <div\n                            class=\"controls-row\"\n                            style=\"display: flex; justify-content: space-between; align-items: center; width: 100%;\"\n                        >\n                            <div\n                                class=\"nav-controls\"\n                                style=\"display: flex; align-items: center; gap: 8px;\"\n                            >\n                                <button mat-icon-button (click)=\"shiftMonths(-1)\">\n                                    <mat-icon>chevron_left</mat-icon>\n                                </button>\n                                <div\n                                    class=\"month-display\"\n                                    style=\"display: flex; align-items: center; gap: 8px; font-weight: 500; font-size: 14px; min-width: 150px; justify-content: center;\"\n                                >\n                                    <span>{{ months()[0] | date: 'MMM yyyy' }}</span>\n                                    <span class=\"separator\">-</span>\n                                    <span>{{\n                                        months()[months().length - 1] | date: 'MMM yyyy'\n                                    }}</span>\n                                </div>\n                                <button mat-icon-button (click)=\"shiftMonths(1)\">\n                                    <mat-icon>chevron_right</mat-icon>\n                                </button>\n                            </div>\n\n                            <div\n                                class=\"density-controls\"\n                                style=\"display: flex; align-items: center; gap: 4px;\"\n                            >\n                                <button\n                                    mat-icon-button\n                                    (click)=\"changeMonthCount(-1)\"\n                                    [disabled]=\"monthCount() <= 1\"\n                                >\n                                    <mat-icon>remove</mat-icon>\n                                </button>\n                                <span style=\"font-size: 12px; color: #666; font-weight: 500;\"\n                                    >{{ monthCount() }} Months</span\n                                >\n                                <button\n                                    mat-icon-button\n                                    (click)=\"changeMonthCount(1)\"\n                                    [disabled]=\"monthCount() >= 12\"\n                                >\n                                    <mat-icon>add</mat-icon>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"grid-wrapper\">\n                        <table class=\"matrix-table\">\n                            <thead>\n                                <tr>\n                                    <th class=\"sticky-col-header\">Account</th>\n                                    @for (month of months(); track month) {\n                                        <th>{{ month | date: 'MMM yy' }}</th>\n                                    }\n                                    <th class=\"total-col-header\">Total</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                @for (row of matrixData(); track row.account.id) {\n                                    <tr>\n                                        <td class=\"sticky-col-header row-header\">\n                                            <div class=\"account-cell\">\n                                                <span class=\"account-name\">{{\n                                                    row.account.name\n                                                }}</span>\n                                                <span class=\"account-average\"\n                                                    >Avg:\n                                                    {{\n                                                        row.averageSpent\n                                                            | currency\n                                                                : preferredCurrency()?.name || ''\n                                                    }}</span\n                                                >\n                                            </div>\n                                        </td>\n                                        @for (cell of row.cells; track cell.month) {\n                                            <td\n                                                class=\"cell-interactive\"\n                                                [class.status-ok]=\"\n                                                    !!cell.budgetItemId &&\n                                                    (cell.calculatedAvailable || 0) >= 0\n                                                \"\n                                                [class.status-over]=\"\n                                                    (cell.calculatedAvailable || 0) < 0\n                                                \"\n                                                [class.status-virtual]=\"cell.isVirtual\"\n                                                (click)=\"editCell(row.account, cell)\"\n                                            >\n                                                <div class=\"cell-content\">\n                                                    <span class=\"planned\">{{\n                                                        cell.amount\n                                                            | currency\n                                                                : preferredCurrency()?.name || ''\n                                                    }}</span>\n                                                    <span class=\"divider\">/</span>\n                                                    <span class=\"spent\">{{\n                                                        cell.spent\n                                                            | currency\n                                                                : preferredCurrency()?.name || ''\n                                                    }}</span>\n                                                </div>\n                                            </td>\n                                        }\n                                        <td\n                                            class=\"total-cell\"\n                                            [class.status-over]=\"\n                                                row.totalPlanned - row.totalSpent < 0\n                                            \"\n                                            [class.status-ok]=\"\n                                                row.totalPlanned - row.totalSpent >= 0\n                                            \"\n                                        >\n                                            <div class=\"cell-content\">\n                                                <span class=\"planned\">{{\n                                                    row.totalPlanned\n                                                        | currency: preferredCurrency()?.name || ''\n                                                }}</span>\n                                                <span class=\"divider\">/</span>\n                                                <span class=\"spent\">{{\n                                                    row.totalSpent\n                                                        | currency: preferredCurrency()?.name || ''\n                                                }}</span>\n                                            </div>\n                                        </td>\n                                    </tr>\n                                }\n                                <!-- Grand Total Row -->\n                                <tr class=\"total-row\">\n                                    <td class=\"sticky-col-header row-header\">Total</td>\n                                    @for (col of columnTotals(); track col.month) {\n                                        <td\n                                            [class.status-over]=\"col.planned - col.spent < 0\"\n                                            [class.status-ok]=\"col.planned - col.spent >= 0\"\n                                        >\n                                            <div class=\"cell-content\">\n                                                <span class=\"planned\">{{\n                                                    col.planned\n                                                        | currency: preferredCurrency()?.name || ''\n                                                }}</span>\n                                                <span class=\"divider\">/</span>\n                                                <span class=\"spent\">{{\n                                                    col.spent\n                                                        | currency: preferredCurrency()?.name || ''\n                                                }}</span>\n                                            </div>\n                                        </td>\n                                    }\n                                    <td\n                                        class=\"total-cell\"\n                                        [class.status-over]=\"\n                                            grandTotal().planned - grandTotal().spent < 0\n                                        \"\n                                        [class.status-ok]=\"\n                                            grandTotal().planned - grandTotal().spent >= 0\n                                        \"\n                                    >\n                                        <div class=\"cell-content\">\n                                            <span class=\"planned\">{{\n                                                grandTotal().planned\n                                                    | currency: preferredCurrency()?.name || ''\n                                            }}</span>\n                                            <span class=\"divider\">/</span>\n                                            <span class=\"spent\">{{\n                                                grandTotal().spent\n                                                    | currency: preferredCurrency()?.name || ''\n                                            }}</span>\n                                        </div>\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            }\n        </div>\n    `,\n    styleUrl: './budget-items.component.scss',\n})\nexport class BudgetItemsComponent implements OnInit {\n    private readonly budgetItemService = inject(BudgetItemService);\n    private readonly snackBar = inject(MatSnackBar);\n    private readonly layoutService = inject(LayoutService);\n    private readonly accountService = inject(AccountService);\n    private readonly userService = inject(UserService);\n    private readonly currencyService = inject(CurrencyService);\n    private readonly dialog = inject(MatDialog);\n    private readonly fb = inject(FormBuilder);\n\n    protected readonly sidenavOpened = this.layoutService.sidenavOpened;\n    protected readonly Creating = signal(false);\n\n    protected readonly budgetItems = this.budgetItemService.budgetItems;\n    protected readonly budgetStatus = this.budgetItemService.budgetStatus;\n    protected readonly accounts = this.accountService.accounts;\n    protected readonly loading = this.budgetItemService.loading;\n    protected readonly currencies = this.currencyService.currencies;\n    protected readonly user = this.userService.user;\n\n    // Configuration Signals\n    protected readonly startDate = signal(new Date()); // Start of the view\n    protected readonly monthCount = signal(3); // Number of months to show\n\n    // Computed state\n    protected readonly preferredCurrency = computed(() => {\n        const user = this.user();\n        const currencies = this.currencies();\n        if (user?.favoriteCurrencyId) {\n            return currencies.find((c) => c.id === user.favoriteCurrencyId);\n        }\n        return currencies.length > 0 ? currencies[0] : null;\n    });\n\n    protected readonly currencyMap = computed(() => {\n        const map = new Map<string, string>(); // Id -> Symbol/Name\n        this.currencies().forEach((c) => map.set(c.id, c.name));\n        return map;\n    });\n\n    protected readonly targetCurrencySymbol = computed(() => {\n        return this.preferredCurrency()?.name || '';\n    });\n\n    protected readonly months = computed(() => {\n        const anchor = this.startDate(); // This is now the END of the view (inclusive)\n        const count = this.monthCount();\n        const result: string[] = [];\n\n        // Use UTC to avoid timezone shifts when calling toISOString\n        const anchorMonth = new Date(Date.UTC(anchor.getFullYear(), anchor.getMonth(), 1));\n\n        for (let i = -(count - 1); i <= 0; i++) {\n            const d = new Date(anchorMonth);\n            d.setUTCMonth(d.getUTCMonth() + i);\n            result.push(d.toISOString());\n        }\n        return result;\n    });\n\n    protected readonly matrixData = computed(() => {\n        // ... existing matrixData logic ...\n        const accs = this.accounts().filter((a) => a.type === 'expense');\n\n        const items = this.budgetItems();\n        const status = this.budgetStatus();\n        const months = this.months();\n        const averages = this.accountService.averages();\n\n        // Maps\n        const itemMap = new Map<string, BudgetItem>();\n        items.forEach((i) => {\n            const m = i.date ? i.date.substring(0, 7) : '';\n            itemMap.set(`${i.accountId}_${m}`, i);\n        });\n\n        const statusMap = new Map<string, BudgetStatus>();\n        status.forEach((s) => {\n            const m = s.date.substring(0, 7);\n            statusMap.set(`${s.accountId}_${m}`, s);\n        });\n\n        const avgMap = new Map(averages.map((a) => [a.accountId, a.averageSpent]));\n\n        const now = new Date();\n        const currentYear = now.getFullYear();\n        const currentMonth = now.getMonth();\n\n        const rows: MatrixRow[] = accs.map((acc) => {\n            let rowTotalPlanned = 0;\n            let rowTotalSpent = 0;\n\n            const cells: MatrixCell[] = months.map((mStr) => {\n                const mKey = mStr.substring(0, 7);\n                const item = itemMap.get(`${acc.id}_${mKey}`);\n                const stat = statusMap.get(`${acc.id}_${mKey}`);\n\n                // Check if this cell is for the current month (Real World time)\n                const cellDate = new Date(mStr);\n                const isCurrentMonth =\n                    cellDate.getUTCFullYear() === currentYear &&\n                    cellDate.getUTCMonth() === currentMonth;\n\n                const spentDisplay = stat?.spent ?? 0;\n\n                let amountDisplay = 0;\n                const rawAmount = item?.amount ?? 0;\n                let isVirtual = false;\n\n                if (item) {\n                    // Explicit budget exists\n                    amountDisplay = stat?.budgeted ?? item.amount;\n                } else {\n                    // No explicit budget\n                    if (isCurrentMonth) {\n                        // Current month: No virtual budget. Strict.\n                        amountDisplay = 0;\n                    } else {\n                        // Past/Future months: Virtual budget = Spent\n                        amountDisplay = spentDisplay;\n                        if (spentDisplay > 0) {\n                            isVirtual = true;\n                        }\n                    }\n                }\n\n                const available = amountDisplay - spentDisplay;\n\n                rowTotalPlanned += amountDisplay;\n                rowTotalSpent += spentDisplay;\n\n                return {\n                    month: mStr,\n                    amount: amountDisplay,\n                    rawAmount: rawAmount,\n                    spent: spentDisplay,\n                    budgetItemId: item?.id,\n                    calculatedAvailable: available,\n                    isVirtual: isVirtual,\n                };\n            });\n\n            return {\n                account: { id: acc.id, name: acc.name },\n                cells,\n                totalPlanned: rowTotalPlanned,\n                totalSpent: rowTotalSpent,\n                averageSpent: avgMap.get(acc.id) ?? 0,\n            };\n        });\n\n        return rows;\n    });\n\n    protected readonly columnTotals = computed(() => {\n        const rows = this.matrixData();\n        const months = this.months();\n        if (rows.length === 0) return [];\n\n        // Init totals\n        const totals = months.map((m) => ({ month: m, planned: 0, spent: 0 }));\n\n        rows.forEach((row) => {\n            row.cells.forEach((cell, idx) => {\n                if (totals[idx]) {\n                    totals[idx].planned += cell.amount;\n                    totals[idx].spent += cell.spent;\n                }\n            });\n        });\n        return totals;\n    });\n\n    protected readonly grandTotal = computed(() => {\n        const cols = this.columnTotals();\n        return cols.reduce(\n            (acc, curr) => ({\n                planned: acc.planned + curr.planned,\n                spent: acc.spent + curr.spent,\n            }),\n            { planned: 0, spent: 0 },\n        );\n    });\n\n    // Effects\n    constructor() {\n        // Reload data when params change\n        effect(() => {\n            const anchor = this.startDate();\n            const count = this.monthCount();\n            const currency = this.preferredCurrency();\n\n            // Calculate query range\n            const anchorMonth = new Date(Date.UTC(anchor.getFullYear(), anchor.getMonth(), 1));\n\n            // From: Anchor - (count-1) months\n            const fromDate = new Date(anchorMonth);\n            fromDate.setUTCMonth(fromDate.getUTCMonth() - (count - 1));\n\n            // To: Anchor + 1 month (exclusive)\n            const toDate = new Date(anchorMonth);\n            toDate.setUTCMonth(toDate.getUTCMonth() + 1);\n\n            const from = fromDate.toISOString();\n            const to = toDate.toISOString();\n\n            const currencyId = currency?.id;\n\n            // Load status with conversion\n            if (currencyId) {\n                this.budgetItemService.loadBudgetStatus(from, to, currencyId).subscribe();\n                this.accountService.loadYearlyExpenses(currencyId).subscribe();\n            } else {\n                this.budgetItemService.loadBudgetStatus(from, to).subscribe();\n                this.accountService.loadYearlyExpenses().subscribe();\n            }\n        });\n    }\n\n    ngOnInit(): void {\n        this.budgetItemService.loadBudgetItems().subscribe();\n        this.accountService.loadAccounts().subscribe();\n        this.currencyService.loadCurrencies().subscribe();\n        this.userService.loadUser().subscribe(); // Loads user -> triggers effect via preferredCurrency\n    }\n\n    // Actions\n    protected shiftMonths(delta: number): void {\n        const current = this.startDate();\n        this.startDate.set(new Date(current.getFullYear(), current.getMonth() + delta, 1));\n    }\n\n    protected changeMonthCount(delta: number): void {\n        const current = this.monthCount();\n        const next = Math.max(1, Math.min(12, current + delta));\n        this.monthCount.set(next);\n    }\n\n    protected editCell(account: { id: string; name: string }, cell: MatrixCell): void {\n        // We pass the RAW amount for editing if we can find it?\n        // Wait, cell.amount is CONVERTED. cell.rawAmount is RAW.\n        // If we don't have a budget item yet, rawAmount is 0.\n        // The dialog should behave effectively.\n\n        // We need to tell the dialog what currency the Account checks?\n        // The dialog just shows \"Amount\".\n        // I added `rawAmount` to MatrixCell interface in computed above. I need to update interface def.\n\n        const dialogRef = this.dialog.open(BudgetMatrixEditComponent, {\n            data: {\n                accountId: account.id,\n                accountName: account.name,\n                month: cell.month,\n                currentAmount: cell.rawAmount ?? 0,\n            },\n            width: '300px',\n        });\n\n        dialogRef.afterClosed().subscribe((result) => {\n            if (result !== undefined) {\n                this.saveBudget(account.id, cell, Number(result));\n            }\n        });\n    }\n\n    private saveBudget(accountId: string, cell: MatrixCell, newAmount: number): void {\n        if (cell.budgetItemId) {\n            this.budgetItemService\n                .update(cell.budgetItemId, {\n                    accountId: accountId,\n                    amount: newAmount,\n                    date: cell.month,\n                    description: 'Matrix Edit',\n                })\n                .subscribe({\n                    next: () => this.refreshData(),\n                    error: () =>\n                        this.snackBar.open('Failed to update', 'Close', { duration: 3000 }),\n                });\n        } else {\n            this.budgetItemService\n                .create({\n                    accountId: accountId,\n                    amount: newAmount,\n                    date: cell.month,\n                    description: 'Matrix Create',\n                })\n                .subscribe({\n                    next: () => this.refreshData(),\n                    error: () =>\n                        this.snackBar.open('Failed to create', 'Close', { duration: 3000 }),\n                });\n        }\n    }\n\n    private refreshData() {\n        this.snackBar.open('Budget saved', 'Close', { duration: 2000 });\n        this.budgetItemService.loadBudgetItems().subscribe();\n\n        // We need to trigger re-fetch of status with current signals using correct view logic\n        const anchor = this.startDate();\n        const count = this.monthCount();\n        const currency = this.preferredCurrency();\n\n        // Use UTC to avoid timezone shifts\n        const anchorMonth = new Date(Date.UTC(anchor.getFullYear(), anchor.getMonth(), 1));\n\n        // From: Anchor - (count-1) months\n        const fromDate = new Date(anchorMonth);\n        fromDate.setUTCMonth(fromDate.getUTCMonth() - (count - 1));\n\n        // To: Anchor + 1 month (exclusive)\n        const toDate = new Date(anchorMonth);\n        toDate.setUTCMonth(toDate.getUTCMonth() + 1);\n\n        const from = fromDate.toISOString();\n        const to = toDate.toISOString();\n\n        const currencyId = currency?.id;\n\n        if (currencyId) {\n            this.budgetItemService.loadBudgetStatus(from, to, currencyId).subscribe();\n            this.accountService.loadYearlyExpenses(currencyId).subscribe();\n        } else {\n            this.budgetItemService.loadBudgetStatus(from, to).subscribe();\n            this.accountService.loadYearlyExpenses().subscribe();\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/budget-items/components/budget-matrix-edit/budget-matrix-edit.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Inject' is defined but never used.","line":1,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Inject, inject } from '@angular/core';\nimport { MAT_DIALOG_DATA, MatDialogRef, MatDialogModule } from '@angular/material/dialog';\nimport { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { DatePipe } from '@angular/common';\nimport { Router } from '@angular/router';\n\nexport interface BudgetMatrixEditData {\n    accountId: string;\n    accountName: string;\n    month: string; // ISO string from caller\n    currentAmount: number;\n}\n\n@Component({\n    selector: 'app-budget-matrix-edit',\n    standalone: true,\n    imports: [\n        MatDialogModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatButtonModule,\n        MatIconModule,\n\n        DatePipe,\n    ],\n    template: `\n        <h2 mat-dialog-title>Budget for {{ data.accountName }}</h2>\n        <div mat-dialog-content>\n            <p class=\"month-label\">{{ data.month | date: 'MMMM yyyy' }}</p>\n\n            <form [formGroup]=\"form\" (ngSubmit)=\"save()\">\n                <mat-form-field appearance=\"outline\" class=\"full-width\">\n                    <mat-label>Planned Amount</mat-label>\n                    <input\n                        matInput\n                        type=\"number\"\n                        formControlName=\"amount\"\n                        min=\"0\"\n                        cdkFocusInitial\n                    />\n                </mat-form-field>\n            </form>\n        </div>\n        <div mat-dialog-actions class=\"actions-container\">\n            <button mat-button color=\"accent\" (click)=\"viewTransactions()\">\n                <mat-icon>list_alt</mat-icon> View Transactions\n            </button>\n            <span class=\"spacer\"></span>\n            <button mat-button (click)=\"cancel()\">Cancel</button>\n            <button mat-flat-button color=\"primary\" (click)=\"save()\" [disabled]=\"form.invalid\">\n                Save\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            .month-label {\n                margin-top: 0;\n                margin-bottom: 16px;\n                color: rgba(0, 0, 0, 0.6);\n            }\n            .full-width {\n                width: 100%;\n            }\n            .actions-container {\n                display: flex;\n                width: 100%;\n                padding: 0 24px 24px 24px; // Adjust padding to match dialog convention if needed\n            }\n            .spacer {\n                flex: 1;\n            }\n        `,\n    ],\n})\nexport class BudgetMatrixEditComponent {\n    private fb = inject(FormBuilder);\n    private dialogRef = inject(MatDialogRef<BudgetMatrixEditComponent>);\n    private router = inject(Router);\n    public data: BudgetMatrixEditData = inject(MAT_DIALOG_DATA);\n\n    protected form = this.fb.group({\n        amount: [this.data.currentAmount, [Validators.required, Validators.min(0)]],\n    });\n\n    constructor() {}\n\n    save() {\n        if (this.form.valid) {\n            this.dialogRef.close(this.form.value.amount);\n        }\n    }\n\n    cancel() {\n        this.dialogRef.close();\n    }\n\n    viewTransactions() {\n        const date = new Date(this.data.month);\n        this.router.navigate(['/transactions'], {\n            queryParams: {\n                accountId: this.data.accountId,\n                month: date.getMonth(),\n                year: date.getFullYear(),\n            },\n        });\n        this.dialogRef.close();\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/budget-items/services/budget-item.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/budget-items/services/budget-item.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/currencies/currencies.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/currencies/currencies.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dialog' is assigned a value but never used.","line":15,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed } from '@angular/core/testing';\nimport { CurrenciesComponent } from './currencies.component';\nimport { CurrencyService } from './services/currency.service';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { signal } from '@angular/core';\nimport { of } from 'rxjs';\nimport { Currency } from '../../core/api/models/currency';\nimport { NoopAnimationsModule } from '@angular/platform-browser/animations';\n\ndescribe('CurrenciesComponent', () => {\n    let component: CurrenciesComponent;\n    let fixture: ComponentFixture<CurrenciesComponent>;\n    let currencyService: jasmine.SpyObj<CurrencyService>;\n    let dialog: MatDialog;\n\n    const mockCurrencies: Currency[] = [\n        { id: '1', name: 'USD', description: 'US Dollar' },\n        { id: '2', name: 'EUR', description: 'Euro' },\n    ];\n\n    beforeEach(async () => {\n        const currencyServiceSpy = jasmine.createSpyObj(\n            'CurrencyService',\n            ['loadCurrencies', 'delete', 'create', 'update'],\n            {\n                currencies: signal(mockCurrencies),\n                loading: signal(false),\n                error: signal(null),\n            },\n        );\n        // Set default return values for methods\n        currencyServiceSpy.loadCurrencies.and.returnValue(of(mockCurrencies));\n        currencyServiceSpy.create.and.returnValue(of({} as Currency));\n        currencyServiceSpy.update.and.returnValue(of({} as Currency));\n        currencyServiceSpy.delete.and.returnValue(of(undefined));\n\n        const snackBarSpy = jasmine.createSpyObj('MatSnackBar', ['open']);\n\n        await TestBed.configureTestingModule({\n            imports: [CurrenciesComponent, NoopAnimationsModule],\n            providers: [\n                { provide: CurrencyService, useValue: currencyServiceSpy },\n                { provide: MatSnackBar, useValue: snackBarSpy },\n            ],\n        }).compileComponents();\n\n        currencyService = TestBed.inject(CurrencyService) as jasmine.SpyObj<CurrencyService>;\n        dialog = TestBed.inject(MatDialog);\n\n        fixture = TestBed.createComponent(CurrenciesComponent);\n        component = fixture.componentInstance;\n    });\n\n    it('should create', () => {\n        expect(component).toBeTruthy();\n    });\n\n    it('should display loading spinner while loading', () => {\n        currencyService.loading.set(true);\n        fixture.detectChanges();\n\n        const compiled = fixture.nativeElement;\n        const spinner = compiled.querySelector('mat-spinner');\n        expect(spinner).toBeTruthy();\n    });\n\n    it('should display currencies in table', () => {\n        currencyService.loadCurrencies.and.returnValue(of(mockCurrencies));\n        fixture.detectChanges();\n\n        expect(component['currencies']()).toEqual(mockCurrencies);\n    });\n\n    it('should open create dialog on add button click', () => {\n        const dialogRefSpy = jasmine.createSpyObj('MatDialogRef', ['afterClosed']);\n        dialogRefSpy.afterClosed.and.returnValue(of(null));\n        const dialogSpy = spyOn(component['dialog'], 'open').and.returnValue(dialogRefSpy);\n\n        component.openCreateDialog();\n\n        expect(dialogSpy).toHaveBeenCalled();\n    });\n\n    it('should open edit dialog on edit button click', () => {\n        const currency = mockCurrencies[0];\n        const dialogRefSpy = jasmine.createSpyObj('MatDialogRef', ['afterClosed']);\n        dialogRefSpy.afterClosed.and.returnValue(of(null));\n        const dialogSpy = spyOn(component['dialog'], 'open').and.returnValue(dialogRefSpy);\n\n        component.openEditDialog(currency);\n\n        expect(dialogSpy).toHaveBeenCalled();\n    });\n\n    it('should show confirmation dialog on delete', () => {\n        const currency = mockCurrencies[0];\n        spyOn(window, 'confirm').and.returnValue(true);\n        currencyService.delete.and.returnValue(of({} as any));\n        currencyService.loadCurrencies.and.returnValue(of([]));\n\n        component.deleteCurrency(currency);\n\n        expect(window.confirm).toHaveBeenCalled();\n        expect(currencyService.delete).toHaveBeenCalledWith(currency.id);\n    });\n\n    it('should call create service when dialog returns result', () => {\n        const newCurrency: Currency = { id: '3', name: 'EUR', description: 'Euro' };\n        const dialogRefSpy = jasmine.createSpyObj('MatDialogRef', ['afterClosed']);\n        dialogRefSpy.afterClosed.and.returnValue(of(newCurrency));\n        spyOn(component['dialog'], 'open').and.returnValue(dialogRefSpy);\n        currencyService.create.and.returnValue(of(newCurrency));\n\n        component.openCreateDialog();\n\n        expect(currencyService.create).toHaveBeenCalledWith(newCurrency);\n    });\n\n    it('should display error message on failure', () => {\n        currencyService.error.set('Failed to load currencies');\n        fixture.detectChanges();\n\n        // The component doesn't expose error directly, but the service does\n        expect(currencyService.error()).toBe('Failed to load currencies');\n    });\n\n    it('should not delete if confirmation is cancelled', () => {\n        const currency = mockCurrencies[0];\n        spyOn(window, 'confirm').and.returnValue(false);\n\n        component.deleteCurrency(currency);\n\n        expect(currencyService.delete).not.toHaveBeenCalled();\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/currencies/currencies.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/currencies/currency-form-dialog/currency-form-dialog.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/currencies/currency-form-dialog/currency-form-dialog.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/currencies/services/currency.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/currencies/services/currency.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/dashboard/dashboard.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/dashboard/dashboard.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currencyService' is assigned a value but never used.","line":18,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userService' is assigned a value but never used.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { MatDialog, MatDialogModule } from '@angular/material/dialog';\nimport { ComponentFixture, TestBed } from '@angular/core/testing';\nimport { DashboardComponent } from './dashboard.component';\nimport { HttpClient, HttpResponse } from '@angular/common/http';\nimport { ApiConfiguration } from '../../core/api/api-configuration';\nimport { AccountService } from '../accounts/services/account.service';\nimport { CurrencyService } from '../currencies/services/currency.service';\nimport { UserService } from '../../core/services/user.service';\nimport { LayoutService } from '../../layout/services/layout.service';\nimport { of } from 'rxjs';\nimport { signal } from '@angular/core';\n\ndescribe('DashboardComponent', () => {\n    let component: DashboardComponent;\n    let fixture: ComponentFixture<DashboardComponent>;\n    let httpClient: jasmine.SpyObj<HttpClient>;\n    let accountService: jasmine.SpyObj<AccountService>;\n    let currencyService: jasmine.SpyObj<CurrencyService>;\n    let userService: jasmine.SpyObj<UserService>;\n    let layoutService: jasmine.SpyObj<LayoutService>;\n    let dialogSpy: jasmine.SpyObj<MatDialog>;\n    let accountsSignal: any;\n\n    // Golden Mock Data satisfying all tests\n    const goldenMockData = {\n        from: '2024-01-01',\n        to: '2024-12-01',\n        granularity: 'month',\n        intervals: [\n            '2024-01-01',\n            '2024-02-01',\n            '2024-03-01',\n            '2024-04-01',\n            '2024-05-01',\n            '2024-06-01',\n            '2024-07-01',\n            '2024-08-01',\n            '2024-09-01',\n            '2024-10-01',\n            '2024-11-01',\n            '2024-12-01',\n        ],\n        currencies: [\n            {\n                currencyId: 'usd',\n                accounts: [\n                    {\n                        accountId: 'asset1',\n                        amounts: [1000, 200, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // 1200 total\n                    },\n                    {\n                        accountId: 'acc1', // expense account\n                        amounts: [50, 60, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n                    },\n                    // For filtering test\n                    { accountId: 'visible', amounts: [100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] },\n                    { accountId: 'hidden', amounts: [200, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] },\n                    { accountId: 'default', amounts: [300, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] },\n                ],\n            },\n        ],\n    };\n\n    beforeEach(async () => {\n        const httpClientSpy = jasmine.createSpyObj('HttpClient', ['request']);\n        httpClientSpy.request.and.returnValue(\n            of(new HttpResponse({ body: goldenMockData as any })),\n        );\n\n        // Create writable signals\n        accountsSignal = signal([]);\n        const averagesSignal = signal([]);\n        const currenciesSignal = signal([]);\n        const userSignal = signal(null);\n\n        // Create spy object with properties\n        const accountServiceSpy = jasmine.createSpyObj(\n            'AccountService',\n            ['loadAccounts', 'update', 'loadYearlyExpenses'],\n            {\n                accounts: accountsSignal,\n                averages: averagesSignal,\n            },\n        );\n\n        accountServiceSpy.loadAccounts.and.returnValue(of([]));\n        accountServiceSpy.loadYearlyExpenses.and.returnValue(of([]));\n        accountServiceSpy.update.and.returnValue(of({} as any));\n\n        const currencyServiceSpy = jasmine.createSpyObj('CurrencyService', ['loadCurrencies'], {\n            currencies: currenciesSignal,\n        });\n        currencyServiceSpy.loadCurrencies.and.returnValue(\n            of([{ id: 'usd', name: 'US Dollar', description: '' }] as any),\n        );\n\n        const userServiceSpy = jasmine.createSpyObj('UserService', ['loadUser'], {\n            user: userSignal,\n        });\n        userServiceSpy.loadUser.and.returnValue(of({ favoriteCurrencyId: null } as any));\n\n        const sidenavOpenedSignal = signal(true);\n        const layoutServiceSpy = jasmine.createSpyObj('LayoutService', ['toggleSidenav']);\n        layoutServiceSpy.sidenavOpened = sidenavOpenedSignal;\n        layoutServiceSpy.sidenavWidth = 250;\n\n        const apiConfigMock = { rootUrl: 'http://localhost:8080/api/v1' };\n\n        dialogSpy = jasmine.createSpyObj('MatDialog', ['open']);\n\n        await TestBed.configureTestingModule({\n            imports: [DashboardComponent],\n            providers: [\n                { provide: HttpClient, useValue: httpClientSpy },\n                { provide: ApiConfiguration, useValue: apiConfigMock },\n                { provide: AccountService, useValue: accountServiceSpy },\n                { provide: CurrencyService, useValue: currencyServiceSpy },\n                { provide: UserService, useValue: userServiceSpy },\n                { provide: LayoutService, useValue: layoutServiceSpy },\n                { provide: MatDialog, useValue: dialogSpy },\n            ],\n        })\n            .overrideComponent(DashboardComponent, {\n                remove: { imports: [MatDialogModule] },\n                add: { providers: [{ provide: MatDialog, useValue: dialogSpy }] },\n            })\n            .compileComponents();\n\n        httpClient = TestBed.inject(HttpClient) as jasmine.SpyObj<HttpClient>;\n        accountService = TestBed.inject(AccountService) as jasmine.SpyObj<AccountService>;\n        currencyService = TestBed.inject(CurrencyService) as jasmine.SpyObj<CurrencyService>;\n        userService = TestBed.inject(UserService) as jasmine.SpyObj<UserService>;\n        layoutService = TestBed.inject(LayoutService) as jasmine.SpyObj<LayoutService>;\n\n        fixture = TestBed.createComponent(DashboardComponent);\n        component = fixture.componentInstance;\n    });\n\n    it('should create', () => {\n        expect(component).toBeTruthy();\n    });\n\n    it('should load expense data on init', (done) => {\n        component.ngOnInit();\n        setTimeout(() => {\n            expect(httpClient.request).toHaveBeenCalledTimes(2);\n            expect(component['expenseData']()).toBeTruthy();\n            done();\n        }, 100);\n    });\n\n    it('should display loading spinner while loading', () => {\n        fixture.detectChanges();\n        component['loading'].set(true);\n        fixture.detectChanges();\n        const compiled = fixture.nativeElement;\n        expect(compiled.querySelector('mat-spinner')).toBeTruthy();\n    });\n\n    it('should show all 12 months on large screens', () => {\n        component['isSmallScreen'].set(false);\n        component['expenseData'].set(goldenMockData as any);\n        const monthColumns = component['monthColumns']();\n        expect(monthColumns.length).toBe(12);\n        expect(monthColumns).toEqual(goldenMockData.intervals);\n    });\n\n    it('should show only 6 months on small screens', () => {\n        component['isSmallScreen'].set(true);\n        component['expenseData'].set(goldenMockData as any);\n        const monthColumns = component['monthColumns']();\n        expect(monthColumns.length).toBe(6);\n        expect(monthColumns).toEqual(goldenMockData.intervals.slice(-6));\n    });\n\n    it('should update screen size based on window width and sidenav state', () => {\n        component['windowWidth'].set(2000);\n        fixture.detectChanges();\n        expect(component['isSmallScreen']()).toBe(false);\n\n        component['windowWidth'].set(1600);\n        fixture.detectChanges();\n        expect(component['isSmallScreen']()).toBe(true);\n\n        layoutService.sidenavOpened.set(false);\n        fixture.detectChanges();\n        expect(component['isSmallScreen']()).toBe(false);\n    });\n\n    it('should load asset data and create asset cards', (done) => {\n        const mockAccounts = [{ id: 'asset1', name: 'My Asset', type: 'asset' }];\n        accountsSignal.set(mockAccounts);\n        accountService.loadAccounts.and.returnValue(of(mockAccounts as any));\n\n        component.ngOnInit();\n\n        setTimeout(() => {\n            const cards = component['assetCards']();\n            expect(cards.length).toBe(1);\n            if (cards.length > 0) {\n                expect(cards[0].accountName).toBe('My Asset');\n                expect(cards[0].balance).toBe(1200);\n            }\n            done();\n        }, 100);\n    });\n\n    it('should filter out asset accounts when showInDashboardSummary is false', (done) => {\n        const mockAccounts = [\n            { id: 'visible', name: 'Visible Asset', type: 'asset', showInDashboardSummary: true },\n            { id: 'hidden', name: 'Hidden Asset', type: 'asset', showInDashboardSummary: false },\n            { id: 'default', name: 'Default Asset', type: 'asset' },\n        ];\n\n        accountsSignal.set(mockAccounts);\n        accountService.loadAccounts.and.returnValue(of(mockAccounts as any));\n\n        component.ngOnInit();\n\n        setTimeout(() => {\n            const cards = component['assetCards']();\n            expect(cards.length).toBe(2);\n            expect(cards.find((c: any) => c.accountId === 'visible')).toBeTruthy();\n            expect(cards.find((c: any) => c.accountId === 'default')).toBeTruthy();\n            expect(cards.find((c: any) => c.accountId === 'hidden')).toBeFalsy();\n            done();\n        }, 100);\n    });\n\n    it('should call accountService.update when onHideAccount is called and dialog is confirmed', () => {\n        const dialogRefSpy = jasmine.createSpyObj({ afterClosed: of(true) });\n        dialogSpy.open.and.returnValue(dialogRefSpy);\n\n        const mockAccounts = [\n            { id: 'acc1', name: 'Test Asset', type: 'asset', showInDashboardSummary: true },\n        ];\n\n        accountsSignal.set(mockAccounts);\n        accountService.update.and.returnValue(of({} as any));\n\n        component['onHideAccount']('acc1');\n\n        expect(dialogSpy.open).toHaveBeenCalled();\n        expect(accountService.update).toHaveBeenCalledWith(\n            'acc1',\n            jasmine.objectContaining({\n                showInDashboardSummary: false,\n            }),\n        );\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/dashboard/dashboard.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/matchers/matcher-edit-dialog/matcher-edit-dialog.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/matchers/matcher-edit-dialog/matcher-edit-dialog.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'computed' is defined but never used.","line":1,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, OnInit, signal, computed, HostListener } from '@angular/core';\nimport { FormBuilder, Validators, ReactiveFormsModule, FormsModule } from '@angular/forms';\nimport { MatDialogModule, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { CommonModule } from '@angular/common';\nimport { MatcherService } from '../services/matcher.service';\nimport { AccountService } from '../../accounts/services/account.service';\nimport { Matcher } from '../../../core/api/models/matcher';\nimport { MatcherNoId } from '../../../core/api/models/matcher-no-id';\nimport { Transaction } from '../../../core/api/models/transaction';\nimport { AccountSelectComponent } from '../../../shared/components/account-select/account-select.component';\n\n@Component({\n    selector: 'app-matcher-edit-dialog',\n    standalone: true,\n    imports: [\n        CommonModule,\n        ReactiveFormsModule,\n        FormsModule,\n        MatDialogModule,\n        MatButtonModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatIconModule,\n        MatChipsModule,\n        MatProgressSpinnerModule,\n        MatProgressSpinnerModule,\n        MatCheckboxModule,\n        AccountSelectComponent,\n    ],\n    templateUrl: './matcher-edit-dialog.component.html',\n    styleUrls: ['./matcher-edit-dialog.component.scss'],\n})\nexport class MatcherEditDialogComponent implements OnInit {\n    private readonly fb = inject(FormBuilder);\n    private readonly dialogRef = inject(MatDialogRef<MatcherEditDialogComponent>);\n    private readonly matcherService = inject(MatcherService);\n    private readonly accountService = inject(AccountService);\n    readonly data = inject<{ matcher?: Matcher; transaction?: Transaction } | undefined>(\n        MAT_DIALOG_DATA,\n    );\n\n    protected readonly accounts = this.accountService.accounts;\n    protected readonly loading = signal(false);\n\n    // Regex/Matcher Testing Signals\n    protected readonly testString = signal('');\n    protected readonly matchResult = signal<{ result?: boolean; reason?: string } | null>(null);\n    protected readonly regexResult = signal<{\n        isValid: boolean;\n        isMatch: boolean;\n        error?: string;\n    } | null>(null);\n    protected readonly testingMatch = signal(false);\n    protected readonly testingRegex = signal(false);\n\n    checkMatch(): void {\n        if (!this.data?.transaction) return;\n\n        this.testingMatch.set(true);\n        const formValue = this.form.value;\n\n        // Construct matcher object from form (excluding output fields which don't affect matching)\n        // We need to be careful to constructing it correctly for the backend check\n        const matcherToCheck: MatcherNoId = {\n            descriptionRegExp: formValue.descriptionRegExp || undefined,\n            partnerNameRegExp: formValue.partnerNameRegExp || undefined,\n            partnerAccountNumberRegExp: formValue.partnerAccountNumberRegExp || undefined,\n            currencyRegExp: formValue.currencyRegExp || undefined,\n            extraRegExp: formValue.extraRegExp || undefined,\n            outputAccountId: 'temp', // Not relevant for matching check\n            outputDescription: 'temp',\n            outputTags: [],\n        };\n\n        const t = this.data.transaction;\n        const transactionToCheck: any = {\n            date: t.date,\n            description: t.description,\n            externalIds: t.externalIds,\n            extra: t.extra,\n            movements: t.movements,\n            partnerAccount: t.partnerAccount,\n            partnerInternalId: t.partnerInternalId,\n            partnerName: t.partnerName,\n            place: t.place,\n            tags: t.tags,\n            unprocessedSources: t.unprocessedSources,\n        };\n\n        this.matcherService.checkMatcher(matcherToCheck, transactionToCheck).subscribe({\n            next: (result) => {\n                this.matchResult.set(result);\n                this.testingMatch.set(false);\n            },\n            error: () => {\n                this.matchResult.set({ result: false, reason: 'Network error checking match' });\n                this.testingMatch.set(false);\n            },\n        });\n    }\n\n    testRegex(): void {\n        const pattern = this.form.controls.descriptionRegExp.value;\n        const test = this.testString();\n\n        if (!pattern || !test) {\n            this.regexResult.set(null);\n            return;\n        }\n\n        this.testingMatch.set(true); // Re-use same loading signal\n        this.matcherService.checkRegex(pattern, test).subscribe({\n            next: (result) => {\n                this.regexResult.set(result);\n                this.testingMatch.set(false);\n            },\n            error: () => {\n                this.regexResult.set({ isValid: false, isMatch: false, error: 'Network error' });\n                this.testingMatch.set(false);\n            },\n        });\n    }\n\n    protected readonly form = this.fb.group({\n        descriptionRegExp: [''],\n        partnerNameRegExp: [''],\n        partnerAccountNumberRegExp: [''],\n        currencyRegExp: [''],\n        extraRegExp: [''],\n        outputAccountId: ['', Validators.required],\n        outputDescription: ['', Validators.required],\n        outputTags: [''], // Comma separated for simplicity initially\n    });\n\n    ngOnInit(): void {\n        this.accountService.loadAccounts().subscribe();\n\n        if (this.data?.matcher) {\n            this.form.patchValue({\n                descriptionRegExp: this.data.matcher.descriptionRegExp,\n                partnerNameRegExp: this.data.matcher.partnerNameRegExp,\n                partnerAccountNumberRegExp: this.data.matcher.partnerAccountNumberRegExp,\n                currencyRegExp: this.data.matcher.currencyRegExp,\n                extraRegExp: this.data.matcher.extraRegExp,\n                outputAccountId: this.data.matcher.outputAccountId,\n                outputDescription: this.data.matcher.outputDescription,\n                outputTags: this.data.matcher.outputTags?.join(', '),\n            });\n        } else if (this.data?.transaction) {\n            // Pre-fill from transaction\n            const t = this.data.transaction;\n            this.form.patchValue({\n                // Suggest name from description/partner\n\n                // Pre-fill regexps with exact matches or simplistic logic (user will edit)\n                descriptionRegExp: this.escapeRegExp(t.description || ''),\n                partnerNameRegExp: t.partnerName ? this.escapeRegExp(t.partnerName) : '',\n                partnerAccountNumberRegExp: t.partnerAccount\n                    ? this.escapeRegExp(t.partnerAccount)\n                    : '',\n                outputDescription: t.description, // Suggest keeping description or edit\n            });\n        }\n    }\n\n    get isCaseInsensitive(): boolean {\n        const val = this.form.controls.descriptionRegExp.value || '';\n        return val.startsWith('(?i)');\n    }\n\n    toggleCaseInsensitive(checked: boolean): void {\n        const val = this.form.controls.descriptionRegExp.value || '';\n        if (checked) {\n            if (!val.startsWith('(?i)')) {\n                this.form.controls.descriptionRegExp.setValue('(?i)' + val);\n            }\n        } else {\n            if (val.startsWith('(?i)')) {\n                this.form.controls.descriptionRegExp.setValue(val.substring(4));\n            }\n        }\n    }\n\n    get isWholeWord(): boolean {\n        let val = this.form.controls.descriptionRegExp.value || '';\n        if (val.startsWith('(?i)')) {\n            val = val.substring(4);\n        }\n        return val.startsWith('\\\\b') && val.endsWith('\\\\b');\n    }\n\n    toggleWholeWord(checked: boolean): void {\n        let val = this.form.controls.descriptionRegExp.value || '';\n        let prefix = '';\n        if (val.startsWith('(?i)')) {\n            prefix = '(?i)';\n            val = val.substring(4);\n        }\n\n        if (checked) {\n            if (!val.startsWith('\\\\b')) val = '\\\\b' + val;\n            if (!val.endsWith('\\\\b')) val = val + '\\\\b';\n        } else {\n            if (val.startsWith('\\\\b')) val = val.substring(2);\n            if (val.endsWith('\\\\b')) val = val.substring(0, val.length - 2);\n        }\n\n        this.form.controls.descriptionRegExp.setValue(prefix + val);\n    }\n\n    private escapeRegExp(string: string): string {\n        return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n    }\n\n    save(): void {\n        if (this.form.invalid) return;\n\n        this.loading.set(true);\n        const formValue = this.form.value;\n\n        const matcherData: MatcherNoId = {\n            descriptionRegExp: formValue.descriptionRegExp || undefined,\n            partnerNameRegExp: formValue.partnerNameRegExp || undefined,\n            partnerAccountNumberRegExp: formValue.partnerAccountNumberRegExp || undefined,\n            currencyRegExp: formValue.currencyRegExp || undefined,\n            extraRegExp: formValue.extraRegExp || undefined,\n            outputAccountId: formValue.outputAccountId!,\n            outputDescription: formValue.outputDescription!,\n            outputTags: formValue.outputTags\n                ? formValue.outputTags\n                      .split(',')\n                      .map((t) => t.trim())\n                      .filter((t) => !!t)\n                : [],\n        };\n\n        const request = this.data?.matcher\n            ? this.matcherService.update(this.data.matcher.id, matcherData)\n            : this.matcherService.create(matcherData);\n\n        request.subscribe({\n            next: () => {\n                this.loading.set(false);\n                this.dialogRef.close(true);\n            },\n            error: () => {\n                this.loading.set(false);\n                // Error handling usually done in service via snackbar or global handler?\n                // If not, we should show message here. Service has error signal.\n            },\n        });\n    }\n\n    close(): void {\n        this.dialogRef.close();\n    }\n    @HostListener('window:keydown.esc')\n    onEsc(): void {\n        if (!this.loading()) {\n            this.close();\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/matchers/matchers.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/matchers/matchers.component.ts","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":164,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":164,"endColumn":63,"suggestions":[{"messageId":"addBrackets","fix":{"range":[5945,6812],"text":"{ const total = matcher.confirmationsTotal || 0;\n                if (total === 0) return -1;\n\n                const count = matcher.confirmationsCount || 0;\n                const score = count / total;\n\n                // Boost score for proven perfect matches (>= 10 confirmations, 100%)\n                // or penalize small perfect matches.\n                // User wants: perfect (>=10) > perfect (<10)\n\n                if (score === 1.0) {\n                    if (count >= 10) {\n                        return 2.0; // Top tier\n                    }\n                    // Small sample perfect: 1.0 - penalty\n                    // Map 1..9 to 0.91..0.99 (approx)\n                    // 9/9 -> 1.0 - 0.001 = 0.999\n                    // 1/1 -> 1.0 - 0.009 = 0.991\n                    return 1.0 - 0.001 * (10 - count);\n                }\n\n                return score; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":167,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":167,"endColumn":63,"suggestions":[{"messageId":"addBrackets","fix":{"range":[5945,6812],"text":"{ const total = matcher.confirmationsTotal || 0;\n                if (total === 0) return -1;\n\n                const count = matcher.confirmationsCount || 0;\n                const score = count / total;\n\n                // Boost score for proven perfect matches (>= 10 confirmations, 100%)\n                // or penalize small perfect matches.\n                // User wants: perfect (>=10) > perfect (<10)\n\n                if (score === 1.0) {\n                    if (count >= 10) {\n                        return 2.0; // Top tier\n                    }\n                    // Small sample perfect: 1.0 - penalty\n                    // Map 1..9 to 0.91..0.99 (approx)\n                    // 9/9 -> 1.0 - 0.001 = 0.999\n                    // 1/1 -> 1.0 - 0.009 = 0.991\n                    return 1.0 - 0.001 * (10 - count);\n                }\n\n                return score; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":168,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":168,"endColumn":45,"suggestions":[{"messageId":"addBrackets","fix":{"range":[5945,6812],"text":"{ const total = matcher.confirmationsTotal || 0;\n                if (total === 0) return -1;\n\n                const count = matcher.confirmationsCount || 0;\n                const score = count / total;\n\n                // Boost score for proven perfect matches (>= 10 confirmations, 100%)\n                // or penalize small perfect matches.\n                // User wants: perfect (>=10) > perfect (<10)\n\n                if (score === 1.0) {\n                    if (count >= 10) {\n                        return 2.0; // Top tier\n                    }\n                    // Small sample perfect: 1.0 - penalty\n                    // Map 1..9 to 0.91..0.99 (approx)\n                    // 9/9 -> 1.0 - 0.001 = 0.999\n                    // 1/1 -> 1.0 - 0.009 = 0.991\n                    return 1.0 - 0.001 * (10 - count);\n                }\n\n                return score; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, OnInit, signal, computed } from '@angular/core';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatSortModule, Sort } from '@angular/material/sort';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatDialog, MatDialogModule } from '@angular/material/dialog';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatcherService } from './services/matcher.service';\nimport { Matcher } from '../../core/api/models/matcher';\nimport { AccountService } from '../accounts/services/account.service';\nimport { LayoutService } from '../../layout/services/layout.service';\nimport { MatcherEditDialogComponent } from './matcher-edit-dialog/matcher-edit-dialog.component';\n\n@Component({\n    selector: 'app-matchers',\n    standalone: true,\n    imports: [\n        MatTableModule,\n        MatSortModule,\n        MatButtonModule,\n        MatIconModule,\n        MatProgressSpinnerModule,\n        MatDialogModule,\n        MatTooltipModule,\n    ],\n    templateUrl: './matchers.component.html',\n    styleUrl: './matchers.component.css',\n})\nexport class MatchersComponent implements OnInit {\n    private readonly matcherService = inject(MatcherService);\n    private readonly accountService = inject(AccountService);\n    private readonly layoutService = inject(LayoutService);\n    private readonly dialog = inject(MatDialog);\n\n    protected readonly sidenavOpened = this.layoutService.sidenavOpened;\n\n    protected readonly loading = this.matcherService.loading;\n    protected readonly displayedColumns = signal([\n        'outputAccount',\n        'outputDescription',\n        'confidence',\n        'actions',\n    ]);\n\n    protected readonly sortActive = signal<string | null>(null);\n    protected readonly sortDirection = signal<'asc' | 'desc'>('asc');\n\n    // Computed signal that enriches matchers with account names and sorts\n    protected readonly matchers = computed(() => {\n        const matchers = this.matcherService.matchers();\n        const accounts = this.accountService.accounts();\n        const columns = this.displayedColumns();\n\n        // Create a map of account IDs to names for quick lookup\n        const accountMap = new Map(accounts.map((acc) => [acc.id, acc.name]));\n\n        // Enrich matchers with account names\n        const enrichedMatchers = matchers.map((matcher) => ({\n            ...matcher,\n            outputAccountName: accountMap.get(matcher.outputAccountId),\n        }));\n\n        if (!columns.length) {\n            return enrichedMatchers;\n        }\n\n        const active = this.sortActive() ?? columns[0];\n        const direction = this.sortDirection();\n\n        // Sort by selected column\n        return [...enrichedMatchers].sort((a, b) => this.compareMatchers(a, b, active, direction));\n    });\n\n    ngOnInit(): void {\n        this.accountService.loadAccounts().subscribe();\n        this.matcherService.loadMatchers().subscribe();\n    }\n\n    protected onSortChange(sort: Sort): void {\n        if (!sort.direction) {\n            this.sortActive.set(null);\n            this.sortDirection.set('asc');\n            return;\n        }\n\n        this.sortActive.set(sort.active);\n        this.sortDirection.set(sort.direction);\n    }\n\n    protected openMatcherDialog(matcher?: Matcher): void {\n        const dialogRef = this.dialog.open(MatcherEditDialogComponent, {\n            data: matcher ? { matcher } : undefined,\n            width: '600px',\n            disableClose: true,\n        });\n\n        dialogRef.afterClosed().subscribe((result) => {\n            if (result) {\n                // List automatically updates via signals in service\n            }\n        });\n    }\n\n    protected deleteMatcher(matcher: Matcher): void {\n        if (confirm(`Are you sure you want to delete matcher \"${matcher.outputDescription}\"?`)) {\n            this.matcherService.delete(matcher.id).subscribe();\n        }\n    }\n\n    protected getConfidenceBadge(matcher: Matcher): {\n        text: string;\n        class: string;\n        tooltip: string;\n    } {\n        const count = matcher.confirmationsCount || 0;\n        const total = matcher.confirmationsTotal || 0;\n\n        if (total === 0) {\n            return { text: 'New', class: 'badge-secondary', tooltip: 'No confirmation history' };\n        }\n\n        const percentage = (count / total) * 100;\n        const isPerfect = percentage === 100;\n        const isLargeSample = count >= 10;\n\n        let badgeClass = 'badge-danger'; // <40%\n        if (isPerfect && isLargeSample) {\n            badgeClass = 'badge-perfect';\n        } else if (percentage >= 70) {\n            badgeClass = 'badge-success';\n        } else if (percentage >= 40) {\n            badgeClass = 'badge-warning';\n        }\n\n        return {\n            text: `${count}/${total}`,\n            class: badgeClass,\n            tooltip: `${count} successful confirmations out of ${total} attempts (${percentage.toFixed(0)}%)`,\n        };\n    }\n\n    private compareMatchers(\n        a: Matcher & { outputAccountName?: string },\n        b: Matcher & { outputAccountName?: string },\n        active: string,\n        direction: 'asc' | 'desc',\n    ): number {\n        const valueA = this.getMatcherSortValue(a, active);\n        const valueB = this.getMatcherSortValue(b, active);\n        return this.comparePrimitiveValues(valueA, valueB, direction);\n    }\n\n    private getMatcherSortValue(\n        matcher: Matcher & { outputAccountName?: string },\n        active: string,\n    ): string | number | null {\n        switch (active) {\n            case 'outputAccount':\n                return matcher.outputAccountName ?? matcher.outputAccountId ?? '';\n            case 'outputDescription':\n                return this.removeLeadingEmoji(matcher.outputDescription ?? '');\n            case 'confidence':\n                const total = matcher.confirmationsTotal || 0;\n                if (total === 0) return -1;\n\n                const count = matcher.confirmationsCount || 0;\n                const score = count / total;\n\n                // Boost score for proven perfect matches (>= 10 confirmations, 100%)\n                // or penalize small perfect matches.\n                // User wants: perfect (>=10) > perfect (<10)\n\n                if (score === 1.0) {\n                    if (count >= 10) {\n                        return 2.0; // Top tier\n                    }\n                    // Small sample perfect: 1.0 - penalty\n                    // Map 1..9 to 0.91..0.99 (approx)\n                    // 9/9 -> 1.0 - 0.001 = 0.999\n                    // 1/1 -> 1.0 - 0.009 = 0.991\n                    return 1.0 - 0.001 * (10 - count);\n                }\n\n                return score;\n            default:\n                return null;\n        }\n    }\n\n    private removeLeadingEmoji(text: string): string {\n        // Remove leading emoji characters for sorting purposes\n        return text\n            .replace(/^[\\p{Emoji}\\p{Emoji_Presentation}\\p{Emoji_Modifier_Base}\\s]+/u, '')\n            .trim();\n    }\n\n    private comparePrimitiveValues(\n        a: string | number | Date | null | undefined,\n        b: string | number | Date | null | undefined,\n        direction: 'asc' | 'desc',\n    ): number {\n        const factor = direction === 'asc' ? 1 : -1;\n\n        if (a == null && b == null) return 0;\n        if (a == null) return 1 * factor;\n        if (b == null) return -1 * factor;\n\n        if (typeof a === 'string' && typeof b === 'string') {\n            return a.localeCompare(b) * factor;\n        }\n\n        if (typeof a === 'number' && typeof b === 'number') {\n            return (a - b) * factor;\n        }\n\n        if (a instanceof Date && b instanceof Date) {\n            return (a.getTime() - b.getTime()) * factor;\n        }\n\n        return `${a}`.localeCompare(`${b}`) * factor;\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/matchers/services/matcher.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/matchers/services/matcher.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/notifications/notifications.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signal' is defined but never used.","line":1,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, OnInit, signal } from '@angular/core';\nimport { MatListModule } from '@angular/material/list';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatSnackBar, MatSnackBarModule } from '@angular/material/snack-bar';\nimport { DatePipe } from '@angular/common';\nimport { NotificationService } from './services/notification.service';\nimport { Notification } from '../../core/api/models/notification';\nimport { LayoutService } from '../../layout/services/layout.service';\n\n@Component({\n    selector: 'app-notifications',\n    imports: [\n        MatListModule,\n        MatIconModule,\n        MatButtonModule,\n        MatProgressSpinnerModule,\n        MatChipsModule,\n        MatSnackBarModule,\n        DatePipe,\n    ],\n    template: `\n        <div class=\"notifications-container\">\n            @if (!sidenavOpened()) {\n                <h1 class=\"page-title\">Notifications</h1>\n            }\n\n            @if (loading()) {\n                <div class=\"loading-container\">\n                    <mat-spinner></mat-spinner>\n                </div>\n            } @else {\n                <mat-list>\n                    @for (notification of notifications(); track notification.id) {\n                        <mat-list-item>\n                            <mat-icon matListItemIcon [class]=\"getIconClass(notification.type)\">\n                                {{ getIcon(notification.type) }}\n                            </mat-icon>\n                            <div matListItemTitle>{{ notification.title }}</div>\n                            <div matListItemLine>{{ notification.description }}</div>\n                            <div matListItemLine class=\"date\">\n                                {{ notification.date | date: 'short' }}\n                            </div>\n                            <button\n                                mat-icon-button\n                                matListItemMeta\n                                (click)=\"deleteNotification(notification)\"\n                            >\n                                <mat-icon>delete</mat-icon>\n                            </button>\n                        </mat-list-item>\n                        <mat-divider></mat-divider>\n                    } @empty {\n                        <mat-list-item>\n                            <div matListItemTitle>No notifications</div>\n                        </mat-list-item>\n                    }\n                </mat-list>\n            }\n        </div>\n    `,\n    styles: `\n        .notifications-container {\n            padding: 0;\n        }\n        .page-title {\n            margin: 0 0 16px 0;\n            font-size: 24px;\n            font-weight: 500;\n        }\n        .loading-container {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height: 300px;\n        }\n        .date {\n            font-size: 12px;\n            color: rgba(0, 0, 0, 0.6);\n        }\n        .icon-other {\n            color: #2196f3;\n        }\n        .icon-match {\n            color: #4caf50;\n        }\n        .icon-no-match {\n            color: #f44336;\n        }\n    `,\n})\nexport class NotificationsComponent implements OnInit {\n    private readonly notificationService = inject(NotificationService);\n    private readonly snackBar = inject(MatSnackBar);\n    private readonly layoutService = inject(LayoutService);\n\n    protected readonly sidenavOpened = this.layoutService.sidenavOpened;\n\n    protected readonly notifications = this.notificationService.notifications;\n    protected readonly loading = this.notificationService.loading;\n\n    ngOnInit(): void {\n        this.notificationService.loadNotifications().subscribe();\n    }\n\n    deleteNotification(notification: Notification): void {\n        if (notification.id) {\n            this.notificationService.delete(notification.id).subscribe({\n                next: () => {\n                    this.snackBar.open('Notification deleted', 'Close', { duration: 3000 });\n                },\n                error: () => {\n                    this.snackBar.open('Failed to delete notification', 'Close', {\n                        duration: 3000,\n                    });\n                },\n            });\n        }\n    }\n\n    getIcon(type: string): string {\n        switch (type) {\n            case 'balanceMatch':\n                return 'check_circle';\n            case 'balanceDoesntMatch':\n                return 'error';\n            default:\n                return 'info';\n        }\n    }\n\n    getIconClass(type: string): string {\n        switch (type) {\n            case 'balanceMatch':\n                return 'icon-match';\n            case 'balanceDoesntMatch':\n                return 'icon-no-match';\n            default:\n                return 'icon-other';\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/notifications/services/notification.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/notifications/services/notification.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/reports/expense-report/expense-report.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/reports/expense-report/expense-report.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/reports/reports.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/settings/settings.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/settings/settings.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Validators' is defined but never used.","line":2,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, OnInit, signal } from '@angular/core';\nimport { FormBuilder, FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSnackBar, MatSnackBarModule } from '@angular/material/snack-bar';\nimport { UserService } from '../../core/services/user.service';\nimport { CurrencyService } from '../currencies/services/currency.service';\nimport { LayoutService } from '../../layout/services/layout.service';\n\n@Component({\n    selector: 'app-settings',\n    imports: [\n        ReactiveFormsModule,\n        MatCardModule,\n        MatFormFieldModule,\n        MatSelectModule,\n        MatButtonModule,\n        MatProgressSpinnerModule,\n        MatSnackBarModule,\n    ],\n    templateUrl: './settings.component.html',\n    styleUrl: './settings.component.scss',\n})\nexport class SettingsComponent implements OnInit {\n    private readonly fb = inject(FormBuilder);\n    protected readonly userService = inject(UserService);\n    private readonly currencyService = inject(CurrencyService);\n    private readonly snackBar = inject(MatSnackBar);\n    private readonly layoutService = inject(LayoutService);\n\n    protected readonly sidenavOpened = this.layoutService.sidenavOpened;\n\n    protected readonly settingsForm: FormGroup;\n    protected readonly user = this.userService.user;\n    protected readonly currencies = this.currencyService.currencies;\n    protected readonly loading = signal(false);\n\n    constructor() {\n        this.settingsForm = this.fb.group({\n            favoriteCurrencyId: [''],\n        });\n    }\n\n    ngOnInit(): void {\n        this.loading.set(true);\n\n        // Load currencies and user data\n        this.currencyService.loadCurrencies().subscribe();\n        this.userService.loadUser().subscribe({\n            next: (user) => {\n                this.settingsForm.patchValue({\n                    favoriteCurrencyId: user.favoriteCurrencyId || '',\n                });\n                this.loading.set(false);\n            },\n            error: () => {\n                this.loading.set(false);\n                this.snackBar.open('Failed to load user settings', 'Close', { duration: 3000 });\n            },\n        });\n    }\n\n    onSave(): void {\n        if (this.settingsForm.valid) {\n            const favoriteCurrencyId = this.settingsForm.value.favoriteCurrencyId || null;\n\n            this.userService.updateFavoriteCurrency(favoriteCurrencyId).subscribe({\n                next: () => {\n                    this.snackBar.open('Settings saved successfully', 'Close', { duration: 3000 });\n                },\n                error: () => {\n                    this.snackBar.open('Failed to save settings', 'Close', { duration: 3000 });\n                },\n            });\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/services/transaction.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/services/transaction.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/transaction-form-dialog/transaction-form-dialog.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/transaction-form-dialog/transaction-form-dialog.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/transactions.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/transactions.component.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/transactions.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dataReloadNeeded' is assigned a value but never used.","line":203,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":203,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, OnInit, signal, computed } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatSortModule, Sort } from '@angular/material/sort';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatDialog, MatDialogModule } from '@angular/material/dialog';\nimport { MatSnackBar, MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { DatePipe } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { TransactionService } from './services/transaction.service';\nimport { Transaction } from '../../core/api/models/transaction';\nimport { TransactionFormDialogComponent } from './transaction-form-dialog/transaction-form-dialog.component';\nimport { AccountService } from '../accounts/services/account.service';\nimport { Account } from '../../core/api/models/account';\nimport { CurrencyService } from '../currencies/services/currency.service';\nimport { Currency } from '../../core/api/models/currency';\nimport { forkJoin, Observable } from 'rxjs';\nimport { TransactionUtils } from './utils/transaction.utils';\nimport { LayoutService } from '../../layout/services/layout.service';\nimport { MatcherService } from '../matchers/services/matcher.service';\nimport { Matcher } from '../../core/api/models/matcher';\n\n@Component({\n    selector: 'app-transactions',\n    imports: [\n        MatTableModule,\n        MatSortModule,\n        MatButtonModule,\n        MatIconModule,\n        MatProgressSpinnerModule,\n        MatDialogModule,\n        MatSnackBarModule,\n        MatTooltipModule,\n        MatChipsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        DatePipe,\n        FormsModule,\n    ],\n    templateUrl: './transactions.component.html',\n    styleUrl: './transactions.component.scss',\n})\nexport class TransactionsComponent implements OnInit {\n    private readonly transactionService = inject(TransactionService);\n    private readonly accountService = inject(AccountService);\n    private readonly currencyService = inject(CurrencyService);\n    private readonly matcherService = inject(MatcherService);\n    private readonly dialog = inject(MatDialog);\n    private readonly snackBar = inject(MatSnackBar);\n    private readonly layoutService = inject(LayoutService);\n\n    private readonly route = inject(ActivatedRoute);\n\n    protected readonly sidenavOpened = this.layoutService.sidenavOpened;\n\n    protected readonly transactions = this.transactionService.transactions;\n    protected readonly loading = signal(false); // Combined loading for transactions, accounts, and currencies\n    protected readonly displayedColumns = signal([\n        'date',\n        'movements',\n        'description',\n        'effectiveAmount',\n        'tags',\n        'actions',\n    ]);\n\n    protected readonly accounts = this.accountService.accounts;\n    protected readonly accountMap = computed<Map<string, Account>>(() => {\n        const map = new Map<string, Account>();\n        this.accounts().forEach((account) => map.set(account.id!, account));\n        return map;\n    });\n\n    protected readonly currencies = this.currencyService.currencies;\n    protected readonly currencyMap = computed<Map<string, Currency>>(() => {\n        const map = new Map<string, Currency>();\n        this.currencies().forEach((currency) => map.set(currency.id!, currency));\n        return map;\n    });\n\n    protected readonly matchers = this.matcherService.matchers;\n    protected readonly matcherMap = computed<Map<string, Matcher>>(() => {\n        const map = new Map<string, Matcher>();\n        this.matchers().forEach((matcher) => map.set(matcher.id!, matcher));\n        return map;\n    });\n\n    // Month navigation state\n    protected readonly currentMonth = signal(new Date().getMonth());\n    protected readonly currentYear = signal(new Date().getFullYear());\n\n    // Computed property for displaying current month/year\n    protected readonly currentMonthDisplay = computed(() => {\n        const date = new Date(this.currentYear(), this.currentMonth(), 1);\n        return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });\n    });\n\n    // Sorting state\n    protected readonly sortActive = signal<string | null>(null);\n    protected readonly sortDirection = signal<'asc' | 'desc'>('asc');\n\n    // Filter state - public for testing\n    readonly selectedAccountIds = signal<string[]>([]);\n    readonly selectedTags = signal<string[]>([]);\n    readonly descriptionFilter = signal<string>('');\n\n    // Computed property for all unique tags from transactions - public for testing\n    readonly availableTags = computed(() => {\n        const tagsSet = new Set<string>();\n        this.transactions().forEach((transaction) => {\n            if (transaction.tags) {\n                transaction.tags.forEach((tag) => tagsSet.add(tag));\n            }\n        });\n        return Array.from(tagsSet).sort();\n    });\n\n    // Computed property for filtered transactions - public for testing\n    readonly filteredTransactions = computed(() => {\n        let filtered = this.transactions();\n\n        // Filter by accounts\n        const accountIds = this.selectedAccountIds();\n        if (accountIds.length > 0) {\n            filtered = filtered.filter((transaction) => {\n                if (!transaction.movements || transaction.movements.length === 0) {\n                    return false;\n                }\n                // Check if any movement's accountId is in the selected accounts\n                return transaction.movements.some(\n                    (movement) => movement.accountId && accountIds.includes(movement.accountId),\n                );\n            });\n        }\n\n        // Filter by tags\n        const tags = this.selectedTags();\n        if (tags.length > 0) {\n            filtered = filtered.filter((transaction) => {\n                if (!transaction.tags || transaction.tags.length === 0) {\n                    return false;\n                }\n                // Check if transaction has any of the selected tags\n                return transaction.tags.some((tag) => tags.includes(tag));\n            });\n        }\n\n        // Filter by description\n        const descFilter = this.descriptionFilter().toLowerCase().trim();\n        if (descFilter) {\n            filtered = filtered.filter((transaction) => {\n                const description = transaction.description?.toLowerCase() || '';\n                return description.includes(descFilter);\n            });\n        }\n\n        return filtered;\n    });\n\n    // Computed property for sorted and filtered transactions\n    protected readonly sortedAndFilteredTransactions = computed(() => {\n        const data = this.filteredTransactions();\n        const columns = this.displayedColumns();\n\n        if (!columns.length) {\n            return data;\n        }\n\n        const active = this.sortActive() ?? columns[0];\n        const direction = this.sortDirection();\n\n        return [...data].sort((a, b) => this.compareTransactions(a, b, active, direction));\n    });\n\n    // Computed property to check if any filters are active - public for testing\n    readonly hasActiveFilters = computed(() => {\n        return (\n            this.selectedAccountIds().length > 0 ||\n            this.selectedTags().length > 0 ||\n            this.descriptionFilter().trim() !== ''\n        );\n    });\n\n    ngOnInit(): void {\n        // Read query parameters\n        this.route.queryParams.subscribe((params) => {\n            let dataReloadNeeded = false;\n\n            if (params['month'] && params['year']) {\n                const month = parseInt(params['month'], 10);\n                const year = parseInt(params['year'], 10);\n                if (!isNaN(month) && !isNaN(year)) {\n                    this.currentMonth.set(month);\n                    this.currentYear.set(year);\n                    dataReloadNeeded = true;\n                }\n            }\n\n            if (params['accountId']) {\n                this.selectedAccountIds.set([params['accountId']]);\n            }\n\n            this.loadData();\n        });\n    }\n\n    loadData(): void {\n        this.loading.set(true);\n        forkJoin([\n            this.accountService.loadAccounts(),\n            this.currencyService.loadCurrencies(),\n            this.matcherService.loadMatchers(),\n            this.loadTransactions(),\n        ]).subscribe({\n            next: () => this.loading.set(false),\n            error: () => this.loading.set(false),\n        });\n    }\n\n    clearFilters(): void {\n        this.selectedAccountIds.set([]);\n        this.selectedTags.set([]);\n        this.descriptionFilter.set('');\n    }\n\n    loadTransactions(): Observable<any> {\n        const startOfMonth = new Date(this.currentYear(), this.currentMonth(), 1);\n        const endOfMonth = new Date(\n            this.currentYear(),\n            this.currentMonth() + 1,\n            0,\n            23,\n            59,\n            59,\n            999,\n        );\n\n        const params = {\n            dateFrom: startOfMonth.toISOString(),\n            dateTo: endOfMonth.toISOString(),\n        };\n\n        return this.transactionService.loadTransactions(params);\n    }\n\n    goToPreviousMonth(): void {\n        if (this.currentMonth() === 0) {\n            this.currentMonth.set(11);\n            this.currentYear.set(this.currentYear() - 1);\n        } else {\n            this.currentMonth.set(this.currentMonth() - 1);\n        }\n        this.loadData();\n    }\n\n    goToNextMonth(): void {\n        if (this.currentMonth() === 11) {\n            this.currentMonth.set(0);\n            this.currentYear.set(this.currentYear() + 1);\n        } else {\n            this.currentMonth.set(this.currentMonth() + 1);\n        }\n        this.loadData();\n    }\n\n    openCreateDialog(): void {\n        const dialogRef = this.dialog.open(TransactionFormDialogComponent, {\n            width: '90vw',\n            maxWidth: '1200px',\n            height: 'auto',\n            maxHeight: '90vh',\n            data: { mode: 'create' },\n        });\n\n        dialogRef.afterClosed().subscribe((result) => {\n            if (result) {\n                this.transactionService.create(result).subscribe({\n                    next: () => {\n                        this.snackBar.open('Transaction created successfully', 'Close', {\n                            duration: 3000,\n                        });\n                        this.loadData(); // Reload data after creation\n                    },\n                    error: () => {\n                        this.snackBar.open('Failed to create transaction', 'Close', {\n                            duration: 3000,\n                        });\n                    },\n                });\n            }\n        });\n    }\n\n    openEditDialog(transaction: Transaction): void {\n        const dialogRef = this.dialog.open(TransactionFormDialogComponent, {\n            width: '90vw',\n            maxWidth: '1200px',\n            height: 'auto',\n            maxHeight: '90vh',\n            data: { mode: 'edit', transaction },\n        });\n\n        dialogRef.afterClosed().subscribe((result) => {\n            if (result && transaction.id) {\n                this.transactionService.update(transaction.id, result).subscribe({\n                    next: () => {\n                        this.snackBar.open('Transaction updated successfully', 'Close', {\n                            duration: 3000,\n                        });\n                        this.loadData(); // Reload data after update\n                    },\n                    error: () => {\n                        this.snackBar.open('Failed to update transaction', 'Close', {\n                            duration: 3000,\n                        });\n                    },\n                });\n            }\n        });\n    }\n\n    deleteTransaction(transaction: Transaction): void {\n        if (confirm(`Are you sure you want to delete this transaction?`)) {\n            if (transaction.id) {\n                this.transactionService.delete(transaction.id).subscribe({\n                    next: () => {\n                        this.snackBar.open('Transaction deleted successfully', 'Close', {\n                            duration: 3000,\n                        });\n                        this.loadData(); // Reload data after deletion\n                    },\n                    error: () => {\n                        this.snackBar.open('Failed to delete transaction', 'Close', {\n                            duration: 3000,\n                        });\n                    },\n                });\n            }\n        }\n    }\n\n    formatMovements(transaction: Transaction): string {\n        if (!transaction.movements || transaction.movements.length === 0) {\n            return 'No movements';\n        }\n\n        const accountMap = this.accountMap();\n\n        // Get input movements (sources of money - negative amounts)\n        const inputMovements = transaction.movements.filter((movement) => movement.amount < 0);\n        const inputAccountNames = inputMovements.map((movement) => {\n            if (!movement.accountId) {\n                return 'Undefined';\n            }\n            return accountMap.get(movement.accountId)?.name || movement.accountId;\n        });\n\n        // Get output movements (destinations of money - positive amounts)\n        const outputMovements = transaction.movements.filter((movement) => movement.amount > 0);\n        const outputAccountNames = outputMovements.map((movement) => {\n            if (!movement.accountId) {\n                return 'Undefined';\n            }\n            return accountMap.get(movement.accountId)?.name || movement.accountId;\n        });\n\n        // Format as \"input => output\"\n        if (inputAccountNames.length === 0 && outputAccountNames.length === 0) {\n            return 'No valid movements';\n        } else if (inputAccountNames.length === 0) {\n            return outputAccountNames.join(', ');\n        } else if (outputAccountNames.length === 0) {\n            return inputAccountNames.join(', ');\n        } else {\n            const inputPart = inputAccountNames.join(', ');\n            const outputPart = outputAccountNames.join(', ');\n            return `${inputPart} => ${outputPart}`;\n        }\n    }\n\n    /**\n     * Get target accounts (positive amounts) for display in the Accounts column\n     * @param transaction The transaction to get target accounts from\n     * @returns A formatted string showing only target accounts\n     */\n    getTargetAccounts(transaction: Transaction): string {\n        if (!transaction.movements || transaction.movements.length === 0) {\n            return '-';\n        }\n\n        const accountMap = this.accountMap();\n\n        // Get output movements (destinations of money - positive amounts)\n        const outputMovements = transaction.movements.filter((movement) => movement.amount > 0);\n        const outputAccountNames = outputMovements.map((movement) => {\n            if (!movement.accountId) {\n                return 'Undefined';\n            }\n            return accountMap.get(movement.accountId)?.name || movement.accountId;\n        });\n\n        if (outputAccountNames.length === 0) {\n            return '-';\n        }\n\n        return outputAccountNames.join(', ');\n    }\n\n    /**\n     * Get the name of a matcher by its ID\n     * @param matcherId The ID of the matcher\n     * @returns The output description of the matcher, or the ID if not found\n     */\n    getMatcherName(matcherId: string): string {\n        const matcher = this.matcherMap().get(matcherId);\n        return matcher?.outputDescription || matcher?.descriptionRegExp || 'Unknown Matcher';\n    }\n\n    protected onSortChange(sort: Sort): void {\n        if (!sort.direction) {\n            this.sortActive.set(null);\n            this.sortDirection.set('asc');\n            return;\n        }\n\n        this.sortActive.set(sort.active);\n        this.sortDirection.set(sort.direction);\n    }\n\n    /**\n     * Format the effective amounts for a transaction\n     * @param transaction The transaction to format\n     * @returns A formatted string showing effective amounts per currency\n     */\n    formatEffectiveAmounts(transaction: Transaction): string {\n        const effectiveAmounts = TransactionUtils.getEffectiveAmounts(transaction);\n\n        if (effectiveAmounts.length === 0) {\n            return 'N/A';\n        }\n\n        const currencyMap = this.currencyMap();\n\n        return effectiveAmounts\n            .map((ea) => {\n                const currency = currencyMap.get(ea.currencyId);\n                const currencyName = currency?.name || ea.currencyId;\n                return `${ea.amount.toFixed(2)} ${currencyName}`;\n            })\n            .join(', ');\n    }\n\n    private compareTransactions(\n        a: Transaction,\n        b: Transaction,\n        active: string,\n        direction: 'asc' | 'desc',\n    ): number {\n        const valueA = this.getTransactionSortValue(a, active);\n        const valueB = this.getTransactionSortValue(b, active);\n        return this.comparePrimitiveValues(valueA, valueB, direction);\n    }\n\n    private getTransactionSortValue(\n        transaction: Transaction,\n        active: string,\n    ): string | number | null {\n        switch (active) {\n            case 'date':\n                return transaction.date || '';\n            case 'description':\n                return transaction.description?.toLowerCase() || '';\n            case 'effectiveAmount': {\n                // Sort by the first effective amount value\n                const effectiveAmounts = TransactionUtils.getEffectiveAmounts(transaction);\n                return effectiveAmounts.length > 0 ? effectiveAmounts[0].amount : 0;\n            }\n            case 'movements': {\n                // Sort by formatted movements string\n                return this.formatMovements(transaction).toLowerCase();\n            }\n            case 'tags': {\n                // Sort by first tag alphabetically\n                if (transaction.tags && transaction.tags.length > 0) {\n                    return transaction.tags.sort()[0].toLowerCase();\n                }\n                return '';\n            }\n            default:\n                return null;\n        }\n    }\n\n    private comparePrimitiveValues(\n        a: string | number | null,\n        b: string | number | null,\n        direction: 'asc' | 'desc',\n    ): number {\n        const factor = direction === 'asc' ? 1 : -1;\n\n        if (a === null && b === null) return 0;\n        if (a === null) return factor;\n        if (b === null) return -factor;\n\n        if (typeof a === 'number' && typeof b === 'number') {\n            return (a - b) * factor;\n        }\n\n        const strA = String(a);\n        const strB = String(b);\n        return strA.localeCompare(strB) * factor;\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/utils/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/utils/transaction.utils.example.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/utils/transaction.utils.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/transactions/utils/transaction.utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/unprocessed-transactions/services/unprocessed-transaction.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/unprocessed-transactions/services/unprocessed-transaction.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/unprocessed-transactions/unprocessed-transaction-dialog/unprocessed-transaction-dialog.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/unprocessed-transactions/unprocessed-transaction-dialog/unprocessed-transaction-dialog.component.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/unprocessed-transactions/unprocessed-transaction-dialog/unprocessed-transaction-dialog.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'combineLatest' is defined but never used.","line":37,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, OnInit, signal, EventEmitter, computed } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport {\n    MAT_DIALOG_DATA,\n    MatDialogModule,\n    MatDialogRef,\n    MatDialog,\n} from '@angular/material/dialog';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { FormsModule, ReactiveFormsModule, FormControl } from '@angular/forms';\nimport { DatePipe } from '@angular/common';\nimport { UnprocessedTransaction } from '../../../core/api/models/unprocessed-transaction';\nimport { UnprocessedTransactionService } from '../../unprocessed-transactions/services/unprocessed-transaction.service';\nimport { MatcherEditDialogComponent } from '../../matchers/matcher-edit-dialog/matcher-edit-dialog.component';\nimport { MatcherAndTransaction } from '../../../core/api/models/matcher-and-transaction';\nimport { Transaction } from '../../../core/api/models/transaction';\nimport { AccountService } from '../../accounts/services/account.service';\nimport { CurrencyService } from '../../currencies/services/currency.service';\nimport { BudgetItemService } from '../../budget-items/services/budget-item.service';\nimport { BudgetItem } from '../../../core/api/models/budget-item';\nimport { Account } from '../../../core/api/models/account';\nimport { Movement } from '../../../core/api/models/movement';\nimport { MatcherService } from '../../matchers/services/matcher.service';\nimport { MatInputModule } from '@angular/material/input';\nimport { HttpClient } from '@angular/common/http';\nimport { ApiConfiguration } from '../../../core/api/api-configuration';\nimport { getMatcher } from '../../../core/api/fn/matchers/get-matcher';\nimport { Matcher } from '../../../core/api/models/matcher';\nimport { startWith, map, combineLatest } from 'rxjs';\nimport { AccountSelectComponent } from '../../../shared/components/account-select/account-select.component';\nimport { toSignal } from '@angular/core/rxjs-interop';\nimport { OverlayModule } from '@angular/cdk/overlay';\n\nexport interface AccountGroup {\n    name: string;\n    accounts: Account[];\n}\n\nexport type UnprocessedTransactionDialogResult =\n    | { action: 'convert'; match: MatcherAndTransaction }\n    | { action: 'delete'; duplicateOf: Transaction }\n    | { action: 'manual'; accountId: string; description?: string }\n    | { action: 'skip' };\n\n@Component({\n    selector: 'app-unprocessed-transaction-dialog',\n    standalone: true,\n    imports: [\n        CommonModule,\n        MatButtonModule,\n        MatDialogModule,\n        MatIconModule,\n        MatListModule,\n        MatCardModule,\n        MatProgressSpinnerModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatAutocompleteModule,\n        MatTooltipModule,\n        FormsModule,\n        ReactiveFormsModule,\n        DatePipe,\n        AccountSelectComponent,\n        OverlayModule,\n    ],\n    templateUrl: './unprocessed-transaction-dialog.component.html',\n    styleUrl: './unprocessed-transaction-dialog.component.scss',\n    styles: [\n        `\n            .badge-loading {\n                opacity: 0.7;\n            }\n        `,\n    ],\n})\nexport class UnprocessedTransactionDialogComponent implements OnInit {\n    private readonly dialogRef = inject(MatDialogRef<UnprocessedTransactionDialogComponent>);\n    private readonly dialog = inject(MatDialog);\n    private readonly service = inject(UnprocessedTransactionService);\n    private readonly accountService = inject(AccountService);\n    private readonly currencyService = inject(CurrencyService);\n    private readonly budgetItemService = inject(BudgetItemService);\n    private readonly matcherService = inject(MatcherService);\n    private readonly http = inject(HttpClient);\n    private readonly apiConfig = inject(ApiConfiguration);\n\n    // Inject data but treat it as initial state\n    readonly initialData = inject<UnprocessedTransaction>(MAT_DIALOG_DATA);\n\n    constructor() {\n        this.descriptionControl.setValue(this.initialData.transaction.description || '');\n    }\n\n    // Signal for the current state of the transaction (can be refreshed)\n    protected readonly transaction = signal<UnprocessedTransaction>(this.initialData);\n\n    protected readonly loading = signal(false);\n    protected readonly accounts = this.accountService.accounts;\n    protected readonly currencies = this.currencyService.currencies;\n    protected readonly budgetItems = signal<BudgetItem[]>([]);\n    protected readonly manualProcessing = signal(false);\n\n    protected readonly showEditPopover = signal(false);\n    protected readonly matcherSearchControl = new FormControl<string | Matcher>('');\n    protected readonly matcherSearchQuery = toSignal(\n        this.matcherSearchControl.valueChanges.pipe(\n            startWith(''),\n            map((v) => (typeof v === 'string' ? v : v?.outputDescription || '')),\n        ),\n        { initialValue: '' },\n    );\n\n    protected readonly allMatchers = this.matcherService.matchers; // Signal from service\n    protected readonly filteredMatchers = computed(() => {\n        const query = this.matcherSearchQuery();\n        const matchers = this.allMatchers();\n\n        let filtered = matchers;\n\n        if (query) {\n            const lowerQuery = query.toLowerCase();\n            filtered = matchers.filter((m) => {\n                const accountName = this.getAccountName(m.outputAccountId).toLowerCase();\n                return (\n                    (m.descriptionRegExp &&\n                        m.descriptionRegExp.toLowerCase().includes(lowerQuery)) ||\n                    (m.outputDescription &&\n                        m.outputDescription.toLowerCase().includes(lowerQuery)) ||\n                    accountName.includes(lowerQuery)\n                );\n            });\n        }\n\n        // Return sorted\n        return filtered.sort((a, b) => {\n            const nameA =\n                `${this.getAccountName(a.outputAccountId)}: ${a.outputDescription || ''}`.toLowerCase();\n            const nameB =\n                `${this.getAccountName(b.outputAccountId)}: ${b.outputDescription || ''}`.toLowerCase();\n            return nameA.localeCompare(nameB);\n        });\n    });\n\n    // Output event for parent component\n    readonly action = new EventEmitter<UnprocessedTransactionDialogResult>();\n\n    protected readonly accountControl = new FormControl<string | null>(null);\n    protected readonly descriptionControl = new FormControl<string>('');\n\n    protected readonly matchersMap = signal<Map<string, Matcher>>(new Map());\n\n    ngOnInit(): void {\n        this.accountService.loadAccounts().subscribe();\n        this.currencyService.loadCurrencies().subscribe();\n        this.budgetItemService.loadBudgetItems().subscribe((items) => {\n            this.budgetItems.set(items);\n        });\n        this.matcherService.loadMatchers().subscribe(); // Load all matchers for the search\n        this.loadMatchers(); // Load specific matchers for this transaction matches (if any missing from global? logic slightly duplicative but okay)\n    }\n\n    // I will replace ngOnInit completely to include the effect/computed logic correctly\n\n    private loadMatchers() {\n        const t = this.transaction();\n        const missingIds = t.matched\n            .map((m) => m.matcherId)\n            .filter((id) => !this.matchersMap().has(id));\n\n        new Set(missingIds).forEach((id) => {\n            getMatcher(this.http, this.apiConfig.rootUrl, { id: id }).subscribe({\n                next: (response) => {\n                    this.matchersMap.update((map) => {\n                        const newMap = new Map(map);\n                        newMap.set(id, response.body);\n                        return newMap;\n                    });\n                },\n                error: (err) => console.error('Failed to load matcher', id, err),\n            });\n        });\n    }\n\n    updateTransaction(transaction: UnprocessedTransaction) {\n        this.loading.set(false);\n        this.accountControl.reset();\n        this.transaction.set(transaction);\n\n        this.descriptionControl.setValue(transaction.transaction.description || '');\n    }\n\n    setLoading(isLoading: boolean) {\n        this.loading.set(isLoading);\n    }\n\n    getAccountName(accountId: string | undefined): string {\n        if (!accountId) return 'Unknown Account';\n        const account = this.accounts().find((a) => a.id === accountId);\n        return account ? account.name : accountId;\n    }\n\n    createMatcher(): void {\n        this.openMatcherDialog();\n    }\n\n    editMatcher(matcher: Matcher): void {\n        this.openMatcherDialog(matcher);\n    }\n\n    private openMatcherDialog(matcher?: Matcher): void {\n        const dialogRef = this.dialog.open(MatcherEditDialogComponent, {\n            data: {\n                transaction: this.transaction().transaction,\n                matcher: matcher,\n            },\n            width: '98%',\n            maxWidth: '98vw',\n            height: '95%',\n            maxHeight: '98vh',\n            disableClose: true,\n        });\n\n        dialogRef.afterClosed().subscribe((result) => {\n            if (result) {\n                // If we edited a matcher, we should refresh the transaction to see if it now matches\n                // Or if we created one.\n                this.refresh();\n                // Also reload matchers list to update the dropdown\n                this.matcherService.loadMatchers().subscribe();\n            }\n        });\n    }\n\n    toggleEditPopover(): void {\n        this.showEditPopover.update((v) => !v);\n        if (this.showEditPopover()) {\n            this.matcherSearchControl.setValue('');\n        }\n    }\n\n    onMatcherSelected(event: any): void {\n        const matcher: Matcher = event.option.value;\n        this.editMatcher(matcher);\n        this.showEditPopover.set(false);\n    }\n\n    displayMatcherFn = (matcher: Matcher): string => {\n        if (!matcher) return '';\n        const accountName = this.getAccountName(matcher.outputAccountId);\n        return `${accountName}: ${matcher.outputDescription || ''}`;\n    };\n\n    private refresh(): void {\n        this.loading.set(true);\n        this.service.getUnprocessedTransaction(this.transaction().transaction.id).subscribe({\n            next: (updatedTransaction) => {\n                this.transaction.set(updatedTransaction);\n                this.loading.set(false);\n            },\n            error: () => {\n                this.loading.set(false);\n                // Handle error? Maybe close dialog or show message\n            },\n        });\n    }\n\n    getCurrencyName(currencyId: string): string {\n        const currency = this.currencies().find((c) => c.id === currencyId);\n        return currency ? currency.name : currencyId;\n    }\n\n    get shouldShowEffectiveAmount(): boolean {\n        return (this.transaction().transaction.movements || []).length === 2;\n    }\n\n    get effectiveAmount(): {\n        amount: number;\n        currencyName: string;\n        knownAccountId?: string;\n    } | null {\n        if (!this.shouldShowEffectiveAmount) return null;\n\n        const movements = this.transaction().transaction.movements || [];\n        const unknownAccountMovement = movements.find((m: Movement) => !m.accountId);\n        const knownAccountMovement = movements.find((m: Movement) => !!m.accountId);\n\n        if (unknownAccountMovement) {\n            return {\n                amount: unknownAccountMovement.amount,\n                currencyName: this.getCurrencyName(unknownAccountMovement.currencyId),\n                knownAccountId: knownAccountMovement?.accountId,\n            };\n        }\n\n        const m = movements[0];\n        return {\n            amount: m.amount,\n            currencyName: this.getCurrencyName(m.currencyId),\n            knownAccountId: movements.find((mov: Movement) => mov !== m)?.accountId,\n        };\n    }\n\n    get knownAccountName(): string | null {\n        const amountData = this.effectiveAmount;\n        if (amountData?.knownAccountId) {\n            return this.getAccountName(amountData.knownAccountId);\n        }\n        return null;\n    }\n\n    applyMatch(match: MatcherAndTransaction): void {\n        this.loading.set(true);\n        this.action.emit({ action: 'convert', match });\n    }\n\n    applyDuplicate(duplicate: Transaction): void {\n        this.loading.set(true);\n        this.action.emit({ action: 'delete', duplicateOf: duplicate });\n    }\n\n    processManual(): void {\n        const accountId = this.accountControl.value;\n\n        if (accountId) {\n            this.loading.set(true);\n            this.action.emit({\n                action: 'manual',\n                accountId,\n                description: this.descriptionControl.value || undefined,\n            });\n        }\n    }\n\n    skip(): void {\n        this.action.emit({ action: 'skip' });\n    }\n\n    getConfidenceBadge(match: MatcherAndTransaction): {\n        text: string;\n        class: string;\n        tooltip: string;\n    } {\n        const matcher = this.matchersMap().get(match.matcherId);\n\n        if (!matcher) {\n            return {\n                text: '...',\n                class: 'badge-secondary badge-loading',\n                tooltip: 'Loading confirmation history...',\n            };\n        }\n\n        const count = matcher.confirmationsCount || 0;\n        const total = matcher.confirmationsTotal || 0;\n\n        if (total === 0) {\n            return { text: 'New', class: 'badge-secondary', tooltip: 'No confirmation history' };\n        }\n\n        const percentage = (count / total) * 100;\n        const isPerfect = percentage === 100;\n        const isLargeSample = count >= 10;\n\n        let badgeClass = 'badge-danger'; // <40%\n        if (isPerfect && isLargeSample) {\n            badgeClass = 'badge-perfect';\n        } else if (percentage >= 70) {\n            badgeClass = 'badge-success';\n        } else if (percentage >= 40) {\n            badgeClass = 'badge-warning';\n        }\n\n        return {\n            text: `${count}/${total}`,\n            class: badgeClass,\n            tooltip: `${count} successful confirmations out of ${total} attempts (${percentage.toFixed(0)}%)`,\n        };\n    }\n\n    close(): void {\n        this.dialogRef.close();\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/unprocessed-transactions/unprocessed-transactions.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/features/unprocessed-transactions/unprocessed-transactions.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/footer/footer.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/footer/footer.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/header/header.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/header/header.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/layout.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/layout.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/services/layout.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/sidebar/sidebar.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/layout/sidebar/sidebar.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/shared/components/account-select/account-select.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/shared/components/account-select/account-select.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signal' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n    Component,\n    computed,\n    forwardRef,\n    inject,\n    Input,\n    OnChanges,\n    SimpleChanges,\n    signal,\n    ViewChild,\n} from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport {\n    ControlValueAccessor,\n    FormControl,\n    FormsModule,\n    NG_VALUE_ACCESSOR,\n    ReactiveFormsModule,\n    Validators,\n} from '@angular/forms';\nimport { MatAutocompleteModule, MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatOptionModule } from '@angular/material/core';\nimport { toSignal } from '@angular/core/rxjs-interop';\nimport { startWith, map } from 'rxjs';\nimport { Account } from '../../../core/api/models/account';\nimport { AccountService } from '../../../features/accounts/services/account.service';\n\nexport interface AccountGroup {\n    name: string;\n    accounts: Account[];\n}\n\n@Component({\n    selector: 'app-account-select',\n    standalone: true,\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatAutocompleteModule,\n        MatOptionModule,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => AccountSelectComponent),\n            multi: true,\n        },\n    ],\n    templateUrl: './account-select.component.html',\n    styleUrls: ['./account-select.component.scss'],\n})\nexport class AccountSelectComponent implements ControlValueAccessor, OnChanges {\n    private readonly accountService: AccountService = inject(AccountService);\n    protected readonly accounts = this.accountService.accounts;\n\n    @Input() label = 'Account';\n    @Input() required = false;\n    @Input() placeholder = 'Select an account';\n\n    @ViewChild('auto') auto!: MatAutocomplete;\n    readonly searchControl = new FormControl<string | Account>('');\n\n    // Internal value tracking (Account ID)\n    private _value: string | null = null;\n    private onChange: (value: string | null) => void = () => {};\n    private onTouched: () => void = () => {};\n\n    protected readonly filterValue = toSignal(\n        this.searchControl.valueChanges.pipe(\n            startWith(''),\n            map((value) => {\n                if (typeof value === 'string') return value;\n                return value?.name || '';\n            }),\n        ),\n        { initialValue: '' },\n    );\n\n    protected readonly filteredAccountGroups = computed(() => {\n        const accounts = this.accounts();\n        const filterValue = (this.filterValue() || '').toLowerCase();\n\n        // 1. Filter\n        const filtered = accounts.filter((account: Account) =>\n            account.name.toLowerCase().includes(filterValue),\n        );\n\n        // 2. Sort\n        filtered.sort((a: Account, b: Account) => a.name.localeCompare(b.name));\n\n        // 3. Group\n        const groups: AccountGroup[] = [];\n        const typeMap = new Map<string, Account[]>();\n\n        filtered.forEach((account: Account) => {\n            const type = account.type || 'Other';\n            if (!typeMap.has(type)) {\n                typeMap.set(type, []);\n            }\n            typeMap.get(type)!.push(account);\n        });\n\n        // Order of groups\n        const order = ['expense', 'income', 'asset', 'liability', 'equity'];\n        const pluralMap: Record<string, string> = {\n            expense: 'Expenses',\n            income: 'Incomes',\n            asset: 'Assets',\n            liability: 'Liabilities',\n            equity: 'Equities',\n        };\n\n        const getGroupName = (type: string) => {\n            return pluralMap[type] || type.charAt(0).toUpperCase() + type.slice(1) + 's';\n        };\n\n        // Add known types in order\n        order.forEach((type) => {\n            if (typeMap.has(type)) {\n                groups.push({ name: getGroupName(type), accounts: typeMap.get(type)! });\n                typeMap.delete(type);\n            }\n        });\n\n        // Add remaining types\n        typeMap.forEach((accounts, type) => {\n            groups.push({ name: getGroupName(type), accounts: accounts });\n        });\n\n        return groups;\n    });\n\n    constructor() {\n        // Ensure accounts are loaded (redundant if app initializes it, but safe)\n        if (this.accounts().length === 0) {\n            this.accountService.loadAccounts().subscribe();\n        }\n\n        // Listen for selection changes from the autocomplete\n        this.searchControl.valueChanges.subscribe((value) => {\n            if (typeof value === 'object' && value !== null) {\n                this.emitValue(value.id);\n            } else if (value === '') {\n                // Clear selection if input is cleared\n                this.emitValue(null);\n            }\n            // Note: If user types text that doesn't match, we don't necessarily clear immediately\n            // until onBlur logic or valid option selected.\n            // But for now, let's keep it simple: only Emit if it's a valid object.\n        });\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n        if (changes['required']) {\n            if (this.required) {\n                this.searchControl.addValidators(Validators.required);\n            } else {\n                this.searchControl.removeValidators(Validators.required);\n            }\n            this.searchControl.updateValueAndValidity();\n        }\n    }\n\n    // ControlValueAccessor implementation\n    writeValue(obj: any): void {\n        this._value = obj;\n        if (obj) {\n            const account = this.accounts().find((a: Account) => a.id === obj);\n            if (account) {\n                this.searchControl.setValue(account, { emitEvent: false });\n            } else {\n                // Handle case where account might not be loaded yet, or invalid\n                // If accounts signal updates later, we might want to re-check.\n                // For now, assume loaded.\n            }\n        } else {\n            this.searchControl.reset(null);\n        }\n    }\n\n    registerOnChange(fn: any): void {\n        this.onChange = fn;\n    }\n\n    registerOnTouched(fn: any): void {\n        this.onTouched = fn;\n    }\n\n    setDisabledState?(isDisabled: boolean): void {\n        if (isDisabled) {\n            this.searchControl.disable();\n        } else {\n            this.searchControl.enable();\n        }\n    }\n\n    displayFn(account: Account): string {\n        return account && account.name ? account.name : '';\n    }\n\n    onBlur() {\n        // If the panel is open, we don't want to clear the value yet.\n        // We will validate when the panel closes.\n        if (this.auto && this.auto.isOpen) {\n            return;\n        }\n        this.validateSelection();\n    }\n\n    validateSelection() {\n        this.onTouched();\n        const val = this.searchControl.value;\n        if (typeof val === 'string' && val !== '') {\n            // Invalid selection (text only)\n            this.searchControl.setValue(null);\n            this.emitValue(null);\n        }\n    }\n\n    private emitValue(value: string | null) {\n        if (this._value !== value) {\n            this._value = value;\n            this.onChange(value);\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/shared/components/confirmation-dialog/confirmation-dialog.component.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/app/shared/components/confirmation-dialog/confirmation-dialog.component.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/environments/environment.prod.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/environments/environment.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/index.html","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/ek/work/GeekBudgetBE/frontend/src/main.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
